<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë±€í”¼ë¥´ ì°¸ì—¬ìœ¨ í†µê³„</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Orbitron:wght@400;700;900&family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; caret-color: transparent; }
        input, textarea, [contenteditable] { caret-color: auto; }
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #101018;
            --bg-card: #14141f;
            --bg-hover: #1e1e2e;
            --accent-gold: #ffd700;
            --accent-gold-dim: #b8860b;
            --accent-cyan: #00d4ff;
            --accent-purple: #a855f7;
            --accent-pink: #ec4899;
            --accent-red: #ef4444;
            --text-primary: #f0f0f5;
            --text-secondary: #888899;
            --border-color: #2a2a3a;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .container { max-width: 1500px; margin: 0 auto; padding: 30px 20px; }
        header { text-align: center; margin-bottom: 35px; }
        
        h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.8rem;
            font-weight: 900;
            color: var(--accent-gold);
            letter-spacing: 4px;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }
        
        .subtitle {
            font-family: 'Orbitron', sans-serif;
            color: var(--text-secondary);
            font-size: 0.9rem;
            letter-spacing: 4px;
            margin-top: 8px;
        }
        
        .top3-display { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        
        .top3-card {
            position: relative;
            padding: 20px 30px;
            border-radius: 16px;
            text-align: center;
            min-width: 180px;
        }
        
        .top3-card.rank-1 {
            background: linear-gradient(135deg, #1a1500 0%, #2d2200 100%);
            border: 2px solid #ffd700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.4), inset 0 0 30px rgba(255, 215, 0, 0.1);
            animation: goldGlow 2s ease-in-out infinite;
        }
        
        .top3-card.rank-2 {
            background: linear-gradient(135deg, #151518 0%, #1f1f25 100%);
            border: 2px solid #c0c0c0;
            box-shadow: 0 0 25px rgba(192, 192, 192, 0.3);
        }
        
        .top3-card.rank-3 {
            background: linear-gradient(135deg, #1a1008 0%, #251a10 100%);
            border: 2px solid #cd7f32;
            box-shadow: 0 0 25px rgba(205, 127, 50, 0.3);
        }
        
        @keyframes goldGlow {
            0%, 100% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.4), inset 0 0 30px rgba(255, 215, 0, 0.1); }
            50% { box-shadow: 0 0 60px rgba(255, 215, 0, 0.6), inset 0 0 40px rgba(255, 215, 0, 0.15); }
        }
        
        .top3-rank { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; font-weight: 900; margin-bottom: 8px; }
        .top3-card.rank-1 .top3-rank { color: #ffd700; text-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
        .top3-card.rank-2 .top3-rank { color: #c0c0c0; text-shadow: 0 0 10px rgba(192, 192, 192, 0.6); }
        .top3-card.rank-3 .top3-rank { color: #cd7f32; text-shadow: 0 0 10px rgba(205, 127, 50, 0.6); }
        .top3-name { font-weight: 700; font-size: 1.1rem; margin-bottom: 4px; }
        .top3-count { color: var(--text-secondary); font-size: 0.9rem; }
        
        .top3-crown {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.8rem;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
            animation: crownBounce 1s ease-in-out infinite;
        }
        
        @keyframes crownBounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }
        
        .nav-tabs { display: flex; gap: 12px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center; }
        
        .nav-tab {
            padding: 12px 24px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .nav-tab:hover { border-color: var(--accent-gold); color: var(--text-primary); }
        .nav-tab.active {
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-gold-dim));
            color: var(--bg-primary);
            border-color: var(--accent-gold);
        }
        
        .panel { display: none; }
        .panel.active { display: block; }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .card-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group { margin-bottom: 20px; }
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9rem;
        }
        .form-label .required { color: var(--danger); margin-left: 4px; }
        .form-label .hint { color: var(--accent-cyan); font-size: 0.8rem; margin-left: 8px; }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
        }
        
        .form-textarea { min-height: 80px; resize: vertical; }
        .form-select { cursor: pointer; }
        .form-select option { background: var(--bg-secondary); }
        
        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 14px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--bg-secondary);
        }
        
        .upload-zone:hover, .upload-zone.dragover { border-color: var(--accent-gold); background: rgba(255, 215, 0, 0.05); }
        .upload-zone.has-file { border-color: var(--success); border-style: solid; }
        
        .upload-icon {
            width: 60px; height: 60px;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-gold-dim));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-icon svg { width: 30px; height: 30px; fill: var(--bg-primary); }
        .upload-text { color: var(--text-primary); margin-bottom: 6px; font-weight: 500; }
        .upload-hint { color: var(--text-secondary); font-size: 0.85rem; }
        .upload-preview {
            max-width: 200px; max-height: 150px;
            margin: 15px auto 0;
            border-radius: 10px;
            display: none;
            border: 2px solid var(--accent-gold);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-gold-dim));
            color: var(--bg-primary);
        }
        
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3); }
        .btn-secondary { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: var(--bg-hover); border-color: var(--accent-gold); }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 8px 16px; font-size: 0.85rem; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        @media (max-width: 1024px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }
        
        .summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 20px;
            text-align: center;
        }
        
        .summary-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--accent-gold);
        }
        
        .summary-label { color: var(--text-secondary); font-size: 0.85rem; margin-top: 6px; }
        
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .data-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .data-table th, .data-table td { padding: 12px 14px; text-align: left; }
        
        .data-table th {
            background: var(--bg-secondary);
            color: var(--accent-gold);
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        
        .data-table tr { border-bottom: 1px solid var(--border-color); }
        .data-table tbody tr:hover { background: var(--bg-hover); }
        
        .data-table tbody tr.rank-1-row {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, transparent 100%);
            animation: goldRowPulse 2s ease-in-out infinite;
        }
        .data-table tbody tr.rank-2-row { background: linear-gradient(90deg, rgba(192, 192, 192, 0.1) 0%, transparent 100%); }
        .data-table tbody tr.rank-3-row { background: linear-gradient(90deg, rgba(205, 127, 50, 0.1) 0%, transparent 100%); }
        
        @keyframes goldRowPulse {
            0%, 100% { background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, transparent 100%); }
            50% { background: linear-gradient(90deg, rgba(255, 215, 0, 0.25) 0%, transparent 100%); }
        }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }
        .badge-pending { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .badge-approved { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .badge-rejected { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .badge-gist { background: rgba(0, 212, 255, 0.2); color: var(--accent-cyan); }
        .badge-absent { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }
        
        .guild-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-right: 5px;
        }
        
        .guild-ì‚¬ì‹  { background: rgba(255, 68, 68, 0.2); color: #ff6666; }
        .guild-ë†€ì { background: rgba(68, 255, 68, 0.2); color: #66ff66; }
        .guild-ì¶•ë³µ { background: rgba(68, 136, 255, 0.2); color: #6699ff; }
        .guild-ë£¨ë¹„ { background: rgba(255, 68, 255, 0.2); color: #ff66ff; }
        .guild-ì•”ì‚´ë‹¨ { background: rgba(255, 170, 0, 0.2); color: #ffbb33; }
        .guild-í—¬ì‹±í‚¤ { background: rgba(0, 255, 255, 0.2); color: #66ffff; }
        
        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px; height: 30px;
            border-radius: 50%;
            font-weight: 900;
            font-size: 0.85rem;
        }
        
        .rank-1 {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #000;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            animation: rank1Pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes rank1Pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); transform: scale(1); }
            50% { box-shadow: 0 0 35px rgba(255, 215, 0, 0.9); transform: scale(1.1); }
        }
        
        .rank-2 {
            background: linear-gradient(135deg, #e8e8e8, #b0b0b0);
            color: #000;
            box-shadow: 0 0 15px rgba(192, 192, 192, 0.5);
        }
        
        .rank-3 {
            background: linear-gradient(135deg, #cd7f32, #a0522d);
            color: #fff;
            box-shadow: 0 0 15px rgba(205, 127, 50, 0.5);
        }
        
        .rank-other { background: var(--bg-secondary); color: var(--text-secondary); }
        
        .progress-bar { height: 8px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden; }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-gold), var(--accent-cyan));
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .chart-container {
            background: var(--bg-secondary);
            border-radius: 14px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .chart-title { font-weight: 700; margin-bottom: 15px; text-align: center; color: var(--accent-gold); }
        .chart-wrapper { position: relative; height: 280px; }
        
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--accent-gold);
            margin-bottom: 20px;
        }
        
        .toast-container {
            position: fixed;
            top: 20px; right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }
        
        .toast.success { border-left: 4px solid var(--success); }
        .toast.warning { border-left: 4px solid var(--warning); }
        .toast.error { border-left: 4px solid var(--danger); }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .processing-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            flex-direction: column;
            gap: 20px;
        }
        
        .processing-overlay.active { display: flex; }
        
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-gold);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .filter-section { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; margin-bottom: 20px; }
        .filter-group { flex: 1; min-width: 150px; }
        .filter-group label { display: block; margin-bottom: 5px; font-size: 0.85rem; color: var(--text-secondary); }
        
        .name-tag {
            display: inline-block;
            background: var(--bg-secondary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--accent-cyan);
            margin: 2px;
            border: 1px solid var(--border-color);
        }
        
        .name-tag.matched { border-color: var(--success); color: var(--success); }
        .name-tag.unmatched { border-color: var(--warning); color: var(--warning); }
        
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .admin-info { display: flex; align-items: center; gap: 10px; color: var(--text-secondary); font-size: 0.9rem; }
        .login-card { max-width: 400px; margin: 50px auto; }
        .empty-state { text-align: center; padding: 50px 20px; color: var(--text-secondary); }
        
        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            min-height: 50px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .tag-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--bg-card);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
        }
        
        .tag-remove { cursor: pointer; color: var(--danger); font-weight: bold; }
        .tag-edit { cursor: pointer; color: var(--accent-cyan); }
        
        #statsExportArea { background: var(--bg-card); padding: 30px; border-radius: 16px; }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-gold-dim); }
        
        .image-modal img { max-width: 100%; max-height: 70vh; border-radius: 10px; }
        
        .guild-filter-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        
        .guild-chip {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }
        
        .guild-chip:hover { border-color: var(--accent-gold); }
        .guild-chip.active { background: var(--accent-gold); color: var(--bg-primary); border-color: var(--accent-gold); }
        
        .member-count { font-size: 0.75rem; color: var(--text-secondary); margin-left: 5px; }
        
        .upload-feed { max-height: 400px; overflow-y: auto; }
        
        .feed-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            background: var(--bg-secondary);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .feed-item:hover { background: var(--bg-hover); }
        .feed-info { flex: 1; }
        .feed-uploader { font-weight: 600; color: var(--text-primary); }
        .feed-meta { font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px; }
        .feed-thumb {
            width: 55px; height: 40px;
            object-fit: cover;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.78rem;
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }
        
        .status-indicator.pending { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
        .status-indicator.approved { background: rgba(34, 197, 94, 0.15); color: var(--success); }
        .status-indicator.gist { background: rgba(0, 212, 255, 0.15); color: var(--accent-cyan); }
        
        .status-dot { width: 6px; height: 6px; border-radius: 50%; animation: pulse 1.5s infinite; }
        .status-dot.pending { background: var(--warning); }
        .status-dot.approved { background: var(--success); }
        .status-dot.gist { background: var(--accent-cyan); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid var(--success);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--success);
        }
        
        .log-success { color: var(--success); }
        .log-fail { color: var(--danger); }
        
        .confirm-modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .confirm-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .confirm-item:last-child { border-bottom: none; }
        .confirm-label { color: var(--text-secondary); }
        .confirm-value { color: var(--text-primary); font-weight: 600; }
        
        .gist-auto-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .gist-auto-status.active { border-left: 3px solid var(--success); }
        .gist-auto-status.inactive { border-left: 3px solid var(--warning); }
        .gist-auto-status .status-text { flex: 1; }
        
        .absent-section {
            background: rgba(168, 85, 247, 0.1);
            border: 1px solid var(--accent-purple);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .absent-section-title {
            color: var(--accent-purple);
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .token-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .token-input-group input {
            flex: 1;
            font-family: monospace;
        }
        
        .token-status {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .token-status.connected {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid var(--success);
        }
        
        .token-status.disconnected {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid var(--danger);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ë±€í”¼ë¥´ ì°¸ì—¬ìœ¨ í†µê³„</h1>
            <p class="subtitle">VAMPYR PARTICIPATION TRACKER</p>
        </header>

        <div class="top3-display" id="top3Display">
            <div class="top3-card rank-2">
                <div class="top3-rank">2nd</div>
                <div class="top3-name" id="top3Name2">-</div>
                <div class="top3-count" id="top3Count2">0íšŒ</div>
            </div>
            <div class="top3-card rank-1">
                <div class="top3-crown">ğŸ‘‘</div>
                <div class="top3-rank">1st</div>
                <div class="top3-name" id="top3Name1">-</div>
                <div class="top3-count" id="top3Count1">0íšŒ</div>
            </div>
            <div class="top3-card rank-3">
                <div class="top3-rank">3rd</div>
                <div class="top3-name" id="top3Name3">-</div>
                <div class="top3-count" id="top3Count3">0íšŒ</div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" data-panel="home">ë©”ì¸</div>
            <div class="nav-tab" data-panel="upload">ì°¸ì—¬ ë“±ë¡</div>
            <div class="nav-tab" data-panel="stats">í†µê³„ í˜„í™©</div>
            <div class="nav-tab" data-panel="absent">ë©”ì¸ìº ë¯¸ì°¸ì—¬</div>
            <div class="nav-tab admin-tab" data-panel="admin" id="adminTab" style="display:none;">ê´€ë¦¬ì</div>
            <div class="nav-tab" data-panel="login" id="loginTab">ê´€ë¦¬ì ë¡œê·¸ì¸</div>
        </div>

        <!-- Home Panel -->
        <div class="panel active" id="panel-home">
            <div class="gist-auto-status inactive" id="gistAutoStatus">
                <span style="font-size:1.5rem;">ğŸ”„</span>
                <div class="status-text">
                    <div style="font-weight:600;">Gist ìë™ ìˆ˜ì§‘</div>
                    <div style="font-size:0.85rem;color:var(--text-secondary);" id="gistAutoStatusText">í† í° ë¯¸ì„¤ì •</div>
                </div>
            </div>
            
            <div class="grid-3" style="margin-bottom:25px;">
                <div class="summary-card">
                    <div class="summary-value" id="homeTotalMembers">0</div>
                    <div class="summary-label">ì´ ì°¸ì—¬ì</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="homeTotalCount" style="color:var(--accent-cyan);">0</div>
                    <div class="summary-label">ì´ ì°¸ì—¬ íšŸìˆ˜</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="homeUploads" style="color:var(--accent-purple);">0</div>
                    <div class="summary-label">ë“±ë¡ëœ ìŠ¤í¬ë¦°ìƒ·</div>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <h2 class="card-title">ğŸ“¡ ì‹¤ì‹œê°„ ì—…ë¡œë“œ í”¼ë“œ</h2>
                    <div class="upload-feed" id="uploadFeed">
                        <div class="empty-state"><p>ì•„ì§ ì—…ë¡œë“œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p></div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">ğŸ† TOP 10 ì°¸ì—¬ì</h2>
                    <div id="homeTopRanking">
                        <div class="empty-state"><p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Panel -->
        <div class="panel" id="panel-upload">
            <div class="grid-2">
                <div class="card">
                    <h2 class="card-title">ğŸ“¤ ì°¸ì—¬ ìŠ¤í¬ë¦°ìƒ· ì—…ë¡œë“œ</h2>
                    
                    <div class="form-group">
                        <label class="form-label">
                            ë³¸ì¸ ë‹‰ë„¤ì„<span class="required">*</span>
                            <span class="hint">(í†µê³„ë¡œ ë¶„ë°°ì‹œ ì¶”ê°€ ë¶„ë°° ì§€ê¸‰)</span>
                        </label>
                        <input type="text" class="form-input" id="uploaderNickname" placeholder="ì—…ë¡œë“œí•˜ì‹œëŠ” ë¶„ì˜ ë‹‰ë„¤ì„">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ì°¸ì—¬ ì‹œê°„ (ë³´íƒ)<span class="required">*</span></label>
                        <select class="form-select" id="participationTime">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ìŠ¤í¬ë¦°ìƒ·<span class="required">*</span></label>
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-icon">
                                <svg viewBox="0 0 24 24"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
                            </div>
                            <p class="upload-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­ ë˜ëŠ” Ctrl+V</p>
                            <p class="upload-hint">PNG, JPG, JPEG ì§€ì›</p>
                            <img class="upload-preview" id="uploadPreview">
                        </div>
                        <input type="file" id="fileInput" accept="image/*" style="display:none">
                    </div>
                    
                    <div class="absent-section">
                        <div class="absent-section-title">
                            <span>ğŸ‘¤</span> ë©”ì¸ ìºë¦­í„° ë¯¸ì°¸ì—¬ (ì„ íƒ)
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <select class="form-select" id="absentMainChar">
                                <option value="">ë¯¸ì°¸ì—¬ ìºë¦­í„° ì—†ìŒ</option>
                            </select>
                            <p style="font-size:0.8rem;color:var(--text-secondary);margin-top:8px;">
                                ë©”ì¸ ìºë¦­í„°ê°€ ì´ë²ˆ ë³´íƒì— ì°¸ì—¬í•˜ì§€ ëª»í–ˆë‹¤ë©´ ì„ íƒí•´ì£¼ì„¸ìš”.
                            </p>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top:20px;">
                        <label class="form-label">ê°„ë‹¨í•œ ì„¤ëª…</label>
                        <textarea class="form-textarea" id="uploadDescription" placeholder="ë©”ëª¨ (ì„ íƒ)"></textarea>
                    </div>
                    
                    <button class="btn btn-primary" id="submitUpload" style="width:100%">
                        ì°¸ì—¬ ë“±ë¡í•˜ê¸°
                    </button>
                </div>
                
                <div class="card">
                    <h2 class="card-title">ğŸ“‹ ìµœê·¼ ì „ì²´ ì—…ë¡œë“œ</h2>
                    <div class="upload-feed" id="recentUploads">
                        <div class="empty-state"><p>ì—…ë¡œë“œ ë‚´ì—­ ì—†ìŒ</p></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Panel -->
        <div class="panel" id="panel-stats">
            <div class="grid-3" style="margin-bottom:15px;">
                <div class="summary-card">
                    <div class="summary-value" id="statTotalMembers">0</div>
                    <div class="summary-label">ì´ ì°¸ì—¬ì</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="statTotalParticipations" style="color:var(--accent-cyan);">0</div>
                    <div class="summary-label">ì´ ì°¸ì—¬ íšŸìˆ˜</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="statApprovedUploads" style="color:var(--accent-purple);">0</div>
                    <div class="summary-label">ìŠ¹ì¸ëœ ë°ì´í„°</div>
                </div>
            </div>
            
            <div class="grid-2" style="margin-bottom:25px;">
                <div class="summary-card" style="border-left:3px solid var(--accent-pink);">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div>
                            <div class="summary-value" id="statGehennaCount" style="color:var(--accent-pink);font-size:1.8rem;">0</div>
                            <div class="summary-label">ğŸ”¥ ê²Œí—¨ë‚˜ ë³´íƒ</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:0.9rem;color:var(--text-secondary);">ì´ <span id="statGehennaTotalRounds">0</span>íšŒ ì§„í–‰</div>
                        </div>
                    </div>
                </div>
                <div class="summary-card" style="border-left:3px solid var(--success);">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div>
                            <div class="summary-value" id="statFieldCount" style="color:var(--success);font-size:1.8rem;">0</div>
                            <div class="summary-label">âš”ï¸ í•„ë“œìŸ</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-size:0.9rem;color:var(--text-secondary);">ì´ <span id="statFieldTotalRounds">0</span>íšŒ ì§„í–‰</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">ğŸ” í•„í„° ë° ë‚´ë³´ë‚´ê¸°</h2>
                <div class="guild-filter-chips" id="guildFilterChips"></div>
                <div class="filter-section">
                    <div class="filter-group">
                        <label>ì‹œì‘ì¼</label>
                        <input type="date" class="form-input" id="filterStartDate">
                    </div>
                    <div class="filter-group">
                        <label>ì¢…ë£Œì¼</label>
                        <input type="date" class="form-input" id="filterEndDate">
                    </div>
                    <div class="filter-group">
                        <label>ì°¸ì—¬ ì‹œê°„</label>
                        <select class="form-select" id="filterTime">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="filter-group" style="flex:0;">
                        <label>&nbsp;</label>
                        <button class="btn btn-secondary" onclick="applyStatsFilter()">í•„í„° ì ìš©</button>
                    </div>
                    <div class="filter-group" style="flex:0;">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" onclick="exportStatsAsImage()">ğŸ“· ì´ë¯¸ì§€ ì €ì¥</button>
                    </div>
                </div>
            </div>
            
            <div id="statsExportArea">
                <div class="card" style="margin-bottom:25px;">
                    <h2 class="card-title">ğŸ† ì°¸ì—¬ìœ¨ ìˆœìœ„</h2>
                    <div id="statsTableContainer">
                        <div class="empty-state"><p>ë°ì´í„° ì—†ìŒ</p></div>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="chart-container">
                        <h3 class="chart-title">ì°¸ì—¬ ë¶„í¬ (ì›í˜•)</h3>
                        <div class="chart-wrapper"><canvas id="pieChart"></canvas></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">ì°¸ì—¬ìë³„ íšŸìˆ˜ (ë§‰ëŒ€)</h3>
                        <div class="chart-wrapper"><canvas id="barChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Absent Panel -->
        <div class="panel" id="panel-absent">
            <div class="card">
                <h2 class="card-title">ğŸ‘¤ ë©”ì¸ ìºë¦­í„° ë¯¸ì°¸ì—¬ í˜„í™©</h2>
                <p style="color:var(--text-secondary);margin-bottom:20px;">
                    ë©”ì¸ ìºë¦­í„°ë¡œ ì°¸ì—¬í•˜ì§€ ëª»í•˜ê³  ë¶€ìºë¡œ ì°¸ì—¬í•œ ê¸°ë¡ì…ë‹ˆë‹¤.
                </p>
                <div id="absentStatsContainer">
                    <div class="empty-state"><p>ë¯¸ì°¸ì—¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p></div>
                </div>
            </div>
        </div>

        <!-- Login Panel -->
        <div class="panel" id="panel-login">
            <div class="card login-card">
                <h2 class="card-title">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                <div class="security-badge" style="margin-bottom:15px;">
                    <span>ğŸ”’</span> SHA-256 ì•”í˜¸í™” ì ìš©
                </div>
                <div class="form-group">
                    <label class="form-label">ì•„ì´ë””</label>
                    <input type="text" class="form-input" id="loginId" placeholder="ê´€ë¦¬ì ì•„ì´ë””">
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-input" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
                </div>
                <div class="form-group">
                    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                        <input type="checkbox" id="loginRemember"> ë¡œê·¸ì¸ ìœ ì§€
                    </label>
                </div>
                <button class="btn btn-primary" onclick="adminLogin()" style="width:100%">ë¡œê·¸ì¸</button>
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="panel" id="panel-admin">
            <div class="admin-header">
                <h2 style="color:var(--accent-gold);">ê´€ë¦¬ì íŒ¨ë„</h2>
                <div class="admin-info">
                    <span id="adminUserDisplay"></span>
                    <button class="btn btn-sm btn-secondary" onclick="adminLogout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            
            <div class="nav-tabs" style="justify-content:flex-start;margin-bottom:20px;">
                <div class="nav-tab active" data-admin-panel="pending">ìŠ¹ì¸ ëŒ€ê¸°</div>
                <div class="nav-tab" data-admin-panel="gisttoken" id="gistTokenTab" style="display:none;">Gist í† í°</div>
                <div class="nav-tab" data-admin-panel="dateconfig">ë‚ ì§œ ì„¤ì •</div>
                <div class="nav-tab" data-admin-panel="maincharlist">ë©”ì¸ ìºë¦­í„° ì„¤ì •</div>
                <div class="nav-tab" data-admin-panel="blacklist">ë¸”ë™ë¦¬ìŠ¤íŠ¸</div>
                <div class="nav-tab" data-admin-panel="rename">ë‹‰ë„¤ì„ ë³€ê²½</div>
                <div class="nav-tab" data-admin-panel="guilds">ê¸¸ë“œ</div>
                <div class="nav-tab" data-admin-panel="nicknames">ë‹‰ë„¤ì„</div>
                <div class="nav-tab" data-admin-panel="times">ë³´íƒ</div>
                <div class="nav-tab" data-admin-panel="logs">ì—…ë¡œë“œ ë¡œê·¸</div>
                <div class="nav-tab" data-admin-panel="loginlogs">ë¡œê·¸ì¸ ë¡œê·¸</div>
                <div class="nav-tab" data-admin-panel="admins" id="superAdminTab" style="display:none;">ê´€ë¦¬ì</div>
            </div>
            
            <!-- Pending -->
            <div class="admin-panel active" id="admin-pending">
                <div class="card">
                    <h2 class="card-title">â³ ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡</h2>
                    <div id="pendingContainer"><div class="empty-state"><p>ëŒ€ê¸° í•­ëª© ì—†ìŒ</p></div></div>
                </div>
            </div>
            
            <!-- Gist Token (Super Admin Only) -->
            <div class="admin-panel" id="admin-gisttoken" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸ”‘ Gist í† í° ì„¤ì • (ìµœì¢…ê´€ë¦¬ì ì „ìš©)</h2>
                    <p style="color:var(--text-secondary);margin-bottom:15px;">
                        GitHub Personal Access Tokenì„ ì…ë ¥í•˜ë©´ ëª¨ë“  Gistë¥¼ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
                    </p>
                    <div class="security-badge" style="margin-bottom:15px;">
                        <span>ğŸ”’</span> í† í°ì€ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">GitHub Personal Access Token</label>
                        <div class="token-input-group">
                            <input type="password" class="form-input" id="gistTokenInput" placeholder="ghp_xxxxxxxxxxxx ë˜ëŠ” github_pat_xxxx">
                            <button class="btn btn-secondary btn-sm" onclick="toggleTokenVisibility()">ğŸ‘</button>
                        </div>
                    </div>
                    
                    <div style="display:flex;gap:10px;flex-wrap:wrap;">
                        <button class="btn btn-primary" onclick="saveGistToken()">í† í° ì €ì¥</button>
                        <button class="btn btn-danger" onclick="clearGistToken()">í† í° ì‚­ì œ</button>
                        <button class="btn btn-secondary" onclick="testGistConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                        <button class="btn btn-success" onclick="syncAllGistsNow()" id="syncNowBtn">ğŸ”„ ì§€ê¸ˆ ë™ê¸°í™”</button>
                    </div>
                    
                    <div class="token-status disconnected" id="tokenStatus">
                        <div style="font-weight:600;" id="tokenStatusTitle">í† í° ë¯¸ì„¤ì •</div>
                        <div style="font-size:0.85rem;color:var(--text-secondary);" id="tokenStatusText">
                            í† í°ì„ ì„¤ì •í•˜ë©´ ìë™ ìˆ˜ì§‘ì´ ì‹œì‘ë©ë‹ˆë‹¤.
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top:20px;background:var(--bg-secondary);">
                        <h3 class="card-title" style="font-size:0.9rem;">ğŸ“Š ë™ê¸°í™” í˜„í™©</h3>
                        <div id="gistSyncStats">
                            <p style="color:var(--text-secondary);">ë™ê¸°í™” ì •ë³´ ì—†ìŒ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Date Config -->
            <div class="admin-panel" id="admin-dateconfig" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸ“… ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •</h2>
                    <p style="color:var(--text-secondary);margin-bottom:20px;">í†µê³„ í•„í„°ì˜ ê¸°ë³¸ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">ê¸°ë³¸ ì‹œì‘ì¼</label>
                            <input type="date" class="form-input" id="configStartDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ê¸°ë³¸ ì¢…ë£Œì¼</label>
                            <input type="date" class="form-input" id="configEndDate">
                            <p style="font-size:0.8rem;color:var(--text-secondary);margin-top:5px;">ë¹„ì›Œë‘ë©´ ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì ìš©</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveDateConfig()">ë‚ ì§œ ì„¤ì • ì €ì¥</button>
                </div>
            </div>
            
            <!-- Main Char List Management -->
            <div class="admin-panel" id="admin-maincharlist" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸ‘¤ ë©”ì¸ ìºë¦­í„° ì„¤ì •</h2>
                    <p style="color:var(--text-secondary);margin-bottom:15px;">ì—…ë¡œë“œ ì‹œ ë¯¸ì°¸ì—¬ ì„ íƒì´ ê°€ëŠ¥í•œ ë©”ì¸ ìºë¦­í„° ëª©ë¡ì…ë‹ˆë‹¤.</p>
                    <div class="form-group">
                        <label class="form-label">ìºë¦­í„° ì¶”ê°€</label>
                        <div style="display:flex;gap:10px;">
                            <input type="text" class="form-input" id="newMainChar" placeholder="ë‹‰ë„¤ì„">
                            <button class="btn btn-primary" onclick="addMainChar()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <hr style="border-color:var(--border-color);margin:20px 0;">
                    <div id="mainCharListContainer"></div>
                </div>
            </div>
            
            <!-- Blacklist -->
            <div class="admin-panel" id="admin-blacklist" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸš« ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬</h2>
                    <p style="color:var(--text-secondary);margin-bottom:15px;">ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ë“±ë¡ëœ ë‹‰ë„¤ì„ì€ í†µê³„ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</p>
                    <div class="form-group">
                        <label class="form-label">ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì¶”ê°€</label>
                        <div style="display:flex;gap:10px;">
                            <input type="text" class="form-input" id="newBlacklist" placeholder="ë‹‰ë„¤ì„">
                            <button class="btn btn-primary" onclick="addBlacklist()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <hr style="border-color:var(--border-color);margin:20px 0;">
                    <div id="blacklistContainer"></div>
                </div>
            </div>
            
            <!-- Rename -->
            <div class="admin-panel" id="admin-rename" style="display:none;">
                <div class="card">
                    <h2 class="card-title">âœï¸ ë‹‰ë„¤ì„ ë³€ê²½ (í†µê³„ ìœ ì§€)</h2>
                    <p style="color:var(--text-secondary);margin-bottom:15px;">ë‹‰ë„¤ì„ì„ ë³€ê²½í•˜ë©´ ê¸°ì¡´ ì°¸ì—¬ ê¸°ë¡ì´ ìƒˆ ë‹‰ë„¤ì„ìœ¼ë¡œ ì´ì „ë©ë‹ˆë‹¤.</p>
                    <div class="form-group">
                        <label class="form-label">ê¸°ì¡´ ë‹‰ë„¤ì„</label>
                        <input type="text" class="form-input" id="renameOldNick" placeholder="ë³€ê²½í•  ë‹‰ë„¤ì„">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ìƒˆ ë‹‰ë„¤ì„</label>
                        <input type="text" class="form-input" id="renameNewNick" placeholder="ìƒˆë¡œìš´ ë‹‰ë„¤ì„">
                    </div>
                    <button class="btn btn-primary" onclick="renameNickname()">ë‹‰ë„¤ì„ ë³€ê²½</button>
                    <hr style="border-color:var(--border-color);margin:20px 0;">
                    <h3 class="card-title">ğŸ“œ ë³€ê²½ ì´ë ¥</h3>
                    <div id="renameHistoryContainer"><div class="empty-state"><p>ë³€ê²½ ì´ë ¥ ì—†ìŒ</p></div></div>
                </div>
            </div>
            
            <!-- Guilds -->
            <div class="admin-panel" id="admin-guilds" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸ° ê¸¸ë“œ ê´€ë¦¬</h2>
                    <div class="form-group">
                        <label class="form-label">ìƒˆ ê¸¸ë“œ</label>
                        <div style="display:flex;gap:10px;">
                            <input type="text" class="form-input" id="newGuildName" placeholder="ê¸¸ë“œëª…">
                            <button class="btn btn-primary" onclick="addGuild()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <hr style="border-color:var(--border-color);margin:20px 0;">
                    <div id="guildListContainer"></div>
                </div>
            </div>
            
            <!-- Nicknames -->
            <div class="admin-panel" id="admin-nicknames" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸ‘¥ ë‹‰ë„¤ì„ ê´€ë¦¬</h2>
                    <div class="form-group">
                        <label class="form-label">ê¸¸ë“œ í•„í„°</label>
                        <select class="form-select" id="nicknameGuildSelect" onchange="renderNicknameList()">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ìƒˆ ë‹‰ë„¤ì„</label>
                        <div style="display:grid;grid-template-columns:1fr 2fr auto;gap:10px;">
                            <select class="form-select" id="newNicknameGuild"></select>
                            <input type="text" class="form-input" id="newNickname" placeholder="ë‹‰ë„¤ì„">
                            <button class="btn btn-primary" onclick="addNickname()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì¼ê´„ ì¶”ê°€</label>
                        <div style="display:grid;grid-template-columns:1fr 2fr;gap:10px;">
                            <select class="form-select" id="bulkNicknameGuild"></select>
                            <textarea class="form-textarea" id="bulkNicknames" placeholder="ë‹‰ë„¤ì„1&#10;ë‹‰ë„¤ì„2"></textarea>
                        </div>
                        <button class="btn btn-secondary" onclick="addBulkNicknames()" style="margin-top:10px;">ì¼ê´„ ì¶”ê°€</button>
                    </div>
                    <hr style="border-color:var(--border-color);margin:20px 0;">
                    <div id="nicknameListContainer"></div>
                </div>
            </div>
            
            <!-- Times -->
            <div class="admin-panel" id="admin-times" style="display:none;">
                <div class="card">
                    <h2 class="card-title">â° ë³´íƒ ì‹œê°„</h2>
                    <div class="form-group">
                        <label class="form-label">ìƒˆ ì‹œê°„ëŒ€</label>
                        <div style="display:flex;gap:10px;">
                            <input type="text" class="form-input" id="newTimeSlot" placeholder="ì˜ˆ: 12:00 ë³´íƒ">
                            <button class="btn btn-primary" onclick="addTimeSlot()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <hr style="border-color:var(--border-color);margin:20px 0;">
                    <div id="timeSlotListContainer"></div>
                </div>
            </div>
            
            <!-- Logs -->
            <div class="admin-panel" id="admin-logs" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸ“œ ì—…ë¡œë“œ ë¡œê·¸</h2>
                    <div class="table-container" id="logsContainer"><div class="empty-state"><p>ë¡œê·¸ ì—†ìŒ</p></div></div>
                </div>
            </div>
            
            <!-- Login Logs -->
            <div class="admin-panel" id="admin-loginlogs" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸ” ë¡œê·¸ì¸ ë¡œê·¸ (ë³´ì•ˆ)</h2>
                    <p style="color:var(--text-secondary);margin-bottom:15px;">ëª¨ë“  ë¡œê·¸ì¸ ì‹œë„ê°€ ê¸°ë¡ë©ë‹ˆë‹¤.</p>
                    <div class="table-container" id="loginLogsContainer"><div class="empty-state"><p>ë¡œê·¸ ì—†ìŒ</p></div></div>
                </div>
            </div>
            
            <!-- Admins -->
            <div class="admin-panel" id="admin-admins" style="display:none;">
                <div class="card">
                    <h2 class="card-title">ğŸ‘‘ ì¤‘ê°„ ê´€ë¦¬ì</h2>
                    <div class="security-badge" style="margin-bottom:15px;">
                        <span>ğŸ”’</span> ë¹„ë°€ë²ˆí˜¸ëŠ” SHA-256ìœ¼ë¡œ ì•”í˜¸í™”ë©ë‹ˆë‹¤
                    </div>
                    <div class="form-group">
                        <label class="form-label">ìƒˆ ê´€ë¦¬ì</label>
                        <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:10px;">
                            <input type="text" class="form-input" id="newAdminId" placeholder="ì•„ì´ë””">
                            <input type="password" class="form-input" id="newAdminPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
                            <button class="btn btn-primary" onclick="addAdmin()">ì¶”ê°€</button>
                        </div>
                    </div>
                    <hr style="border-color:var(--border-color);margin:20px 0;">
                    <div id="adminListContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="imageModal">
        <div class="modal image-modal" style="max-width:800px;">
            <h3 class="modal-title">ìŠ¤í¬ë¦°ìƒ·</h3>
            <img id="modalImage" src="" alt="Preview">
            <div style="margin-top:20px;display:flex;gap:10px;justify-content:flex-end;">
                <button class="btn btn-secondary" onclick="closeImageModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="matchModal">
        <div class="modal">
            <h3 class="modal-title">ë‹‰ë„¤ì„ ë§¤ì¹­</h3>
            <p style="color:var(--text-secondary);margin-bottom:20px;">OCR ì¸ì‹ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
            <div id="matchResults"></div>
            <div style="margin-top:20px;display:flex;gap:10px;justify-content:flex-end;">
                <button class="btn btn-secondary" onclick="closeMatchModal()">ì·¨ì†Œ</button>
                <button class="btn btn-success" onclick="confirmMatch()">ìŠ¹ì¸</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <h3 class="modal-title">ğŸ“‹ ë“±ë¡ ë‚´ìš© í™•ì¸</h3>
            <p style="color:var(--text-secondary);margin-bottom:20px;">ì´ëŒ€ë¡œ ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="confirm-modal-content" id="confirmContent"></div>
            <div style="display:flex;gap:10px;justify-content:flex-end;">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" id="confirmSubmitBtn">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>
    
    <div class="processing-overlay" id="processingOverlay">
        <div class="spinner"></div>
        <p id="processingText" style="color:var(--accent-gold);">ì²˜ë¦¬ ì¤‘...</p>
    </div>

    <script>
        // SHA-256
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        // ==================== FIREBASE ì„¤ì • ====================
  apiKey: "AIzaSyBlOOYHY-nPtbEM6URacDV-MA9ccm1br74",
  authDomain: "vampyr-tracker.firebaseapp.com",
  databaseURL: "https://vampyr-tracker-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "vampyr-tracker",
  storageBucket: "vampyr-tracker.firebasestorage.app",
  messagingSenderId: "228992340552",
  appId: "1:228992340552:web:0fe1d06c421987e7e17e7d"
};
        
        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const DB_REF = 'vampyrTracker'; // ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ
        
        const SUPER_ADMIN_ID = 'tjdals9328';
        const GIST_SYNC_INTERVAL = 15 * 60 * 1000; // 15ë¶„
        
        const INITIAL_GUILDS = ['ì‚¬ì‹ ', 'ì¶•ë³µ', 'ë†€ì', 'ë£¨ë¹„', 'ì•”ì‚´ë‹¨', 'í—¬ì‹±í‚¤'];
        const INITIAL_MEMBERS = {"ì‚¬ì‹ ":["ê°“ëª…í’ˆ","ì¹¼ë¦¬","ì¬ë²”êµ°ì£¼","ë¹…ì‚¬ë•…","ì›í","ê¸°ì–µ","ê¼¬ë ¥","ì•„ì´ì— ì†”ì´","ì‚¬ì‹ ë”±ì´","ë‹¬ë¹›","ì €ì£¼ê³ ë¨¸","ë¬´ê¸°x","ë¡œì‚¬ëƒ¥","IVA","ê°œë…ì¢…","ë‹ˆì½œë¼ìš”í‚¤ì¹˜","ë¬´ì§€","í”¼ìŠ¤í†¨","ë°”ì´í¼V","í—ˆíŒŒ","ì‚°íƒ€ì‚´ì¸ë§ˆ","ê³ ì§‘","ì—¬ì£¼","ëŒ€ë¨¸ë¦¬ë™ìƒ","ê°•ê°€ëŒ","ì‚¬ì¸ ","ì—°ë‘","í›„ë³´","êµ­ë¯¼ì—°ê¸ˆ","ë²¨ë¡ ë“œ","ì—˜ë¦°","ê°“í’ˆê²©","ìŒìŠ¤","ëŒœë¦‰","ì‚¬ìš°ì","ë¹¡ë”œ","ì½©ë¹ˆ","9ì‚¬ë‹¨","ë©¸ì¹˜ìœ¡ìˆ˜","ì¸„ì›…","íˆ¬ê¿","RIEDELì‡¼êµ°","ë¬¼íƒœ","ë±€íŒŒì´ì¡ì´","FOM","ì›í†µë¦¬í¼","ë‚¨ë‚¨","ì„œì´ˆì—í”¼ì†Œë“œ","ê°•ì œë…¸ì—­ë£¨ëŒí”„","ìŠ¹ë¶€"],"ì¶•ë³µ":["ë±€íŒŒì´ì–´í€¸","ë¶ˆíƒ€ëŠ”ëˆê¹Œì“°","ë¦¬ë²¨ë¦¬ì˜¨","ë¯¼ë²Œêµ¬","ì½”ë¥´í¬ë§ˆê°œ","ë‹¤ë‚˜ì•„ë¹ ","ë¯¸ë“œí­ê²©ê¸°","ì¨ì¤€","í•˜ë‚˜","ì½©ë–¡e","ëŒ€ë¨¸ë¦¬ì¹­êµ¬","Poatan","í‘¹ì°","í”„ë¦´","ì°Œìœ ì°Œìœ ê¹€ì˜","ë¹›ë‚˜ì–‘","ì „ë‹´ë§ˆë µë„¤","í˜¸íƒœì™•","OIìœì´","ë¬ ì´","Lily7","ë°¤OI","íêµ¬ë¦¬","ë‚¨ê¹¡ì´","ì¥ë‹˜","ìŸí”¼ë£¨","ë¹…ì´ì‚¬","ë°˜í•­ì•…ë™","ë°§ë“€","ê²€ì€í›„ë“œ","ê¼¬ë§¹ì´83","ë ë ìš©","ì„¬ì›","ì´ì•„ë¦„","ì´ì›íƒ","ì¶©í˜„","ì¹¸íƒ•","í‚¤í‚¥","í­êµ°ëŒ€ì¥","íœ´ì¸ìƒ"],"ë†€ì":["í‚¬ë¼ë¹„","ì„œë¸Œë§ˆë¦¬ë„ˆ","ë²„ì¦ˆë¼ì´íŠ¸","ë‹¬ë¦¬ìëª½í‚¤","ê³ ê°ë‹˜ì‚¬ë‘í•©ë‹ˆë‹¤","ìŠ¤ìœ—ë¬¼ì†Œ","í—¥ì‚¬ì‹ ","ê³ ëŒ€","ê°“ëª…í’ˆì™¼ì†","ê´€ì¥ë‹˜","ë‹¬ë¹›ì†Œë¥˜ì§€ì—ì„œ","ê¸°ë„¤ìŠ¤ë¶","ê¹€í™ë¯¼","í˜„ë¸”","ì¹˜í‚¨í”¼ìíƒ•ìˆ˜ìœ¡ìˆ˜","ì¹´íƒ€ë¸Œë¼","ê°“ëª…í’ˆì˜¤ë¥¸ì†","ë¹…í”¼ë¥´","ë¶€ì—¬êµ°ì£¼","ìŠ¤í‹¸ë³¸","ë‘ë‘ë‘ë‘‘","ì•”ë‚˜ì´íŠ¸","ì…€ë¦°ëŠ","ë¯¸ì†Œë¹ ë”°","LOTS","ë ˆë“œë¶ˆ","ì„¸ë‚˜ë£½","ëª°ë‘ëª¨ì°Œ","ìœ¼ì± ","ìŠ¤ì½”ì¹˜","ë¹…ì •êµ¬ë‹ˆ","ë¹…ì •êµ°ì´","í—êµ¬ë¦¬","ëšœí","ë¹…ë‹¤ëŒ","ê°ˆë¦¬ë“œ","ê·¸ë†ˆë¬¼ê±´ì´ë„¤","ë””ë¥´ëª¨","ë³„ë‚¨ì","ë¹…ë¶€ì•„ì•™","ì™•ë•ë°°","í•´ë¬¼ë³¶ìŒë°¥"],"ë£¨ë¹„":["ê°“ë§ì¹˜","í”„ë¼ì‹œì—˜","ëˆ„ê°€ë¨¼ì €ì ‘ë‚˜","ë•ë§Œ","ì¶œë í•‘","í•‘í¬ë²„í‚¨","ë­‰ì¹˜ë¸”ìŠ¤","epicepic","ì¹µë©§","í† ë¼ì","ë§¥ë£¨í•œ","í•‘ë¯¸","ê¿ˆì‹ ","ë¬µê·€","ìˆ˜ì ","QA","í† ì‹¤í•‘1","í•„ê·¸ë¦¼","ê¿ë¹µ","ì‰ì‰ì–´","ëšœìœ ","ì¥ë°œë…€","ì¼€ì´ë„","í†°ê³¼ì œë‹ˆ","ì¹´ë¦¬ì´ì§€","í•œë™ìˆ˜","ë¡œë´‡ì²­ì†Œ","ë…ì¼","ì•µë„¤","í”Œë¦¬í•‘","ì§„ê²©ì˜ê³ ì¸ë¬¼","ëœë í•‘","ëš±2","ë¹„ì–Œì´","ì•„íŒ¡","ì§€ì„œë‹ˆ","ì°¨ëˆ™ì´","í„°ê¸°","í‰ëŒ€","í•¨ì •ë§¨","í˜¼ë˜"],"ì•”ì‚´ë‹¨":["ì €ê±´ëª¨ì•¼","ìŠ¤ìœ™ë¹ ì´","Tì—†Eë§‘ì€E","ì„¹ì‰¬ì•¼ë§ˆ","íƒœê¸°ë‹ˆì¦˜","ì—ë¨¸ì‹­ìœ¡","ë¶ˆíƒ€ëŠ”í”¼ì•„ë…¸","ê²œëŒ","ë°í†¨","íˆì•„íœ˜ì•¼","í™‹í™‹","ì—˜ë¦¬","ì¼ë‹¨ì°”ëŸ¬","ë¬¼ë´„","ì‹œë¦¬","ì†¡ìœ¤ì•„","ê·¸ê±´ëª¨ì•¼","ì•„í¬ë£¨ë¼","í˜ˆìœ¡","ê°•ë¬¸ì˜","ì¶”ìì—°","ìœ ì—°","ë°°ì¶”ì™€ê¹€ì¹˜","ì°Œë‹ˆë‹¤ì•„","í•´í”¼ì—”ë”©","ì•„ë¡±ì´ì§€ë¡±ì—¬","ì €ê²Œëª¨ì•¼","ê³ ë¬´ì‹ ","Jaei","ë°°ë¦¬","ë²Œê¿€ì˜¤ì†Œë¦¬","ìƒˆë¹¨ê°„ë¦½ìŠ¤í‹±","ìœ ë ì‰","ì´ìƒí•´ê½ƒ","íí‹°ì•¼ë§ˆ","í™©ê°€ëŒ"],"í—¬ì‹±í‚¤":["ví”¼o","í‚¤ìš”ë¯¸","ì´ë””ë‚˜","íšŒí”¼","íŠœë”","ì´ˆì¡°","ë¯¸ê¹Œì‚¬","í˜¸ë¦¬ì  íƒˆ1","ë°¤ë„›","sìš”ì •s","ìŠˆí†µ","ê¹€ì •í","ë§ˆë ¥ì´","ë¬´ë³´ì •","ëŠë‚Œì´","ê¶ë””ì´","ë¯¸ì¹œë„ë¼ì´","ë¼í˜ì§„","ì˜¤í˜ë¥´íƒ€","ê°œì½”","ìµœì•…","ì†¡ê³³ì´","í°ìˆ˜ì—¼ê³ ë˜","ì–Œì²´","ë‚˜ë¹„íš¨ê³¼","ìˆ˜ì„œ","ì¹´ë£¨ìš”","ë±€ê¾¸ë¦¬","ë¶ˆê°•ëƒ‰ì´","ì‹œí´","ì ˆëŒ€ìŒ€ë¨¹","ê°€ìœ„íŒŒì°¨ì€ì§„","supero","sdí…Œì´","ë§¤ë¦¬ì–´íŠ¸","ì…‹ì¹´"]};
        const INITIAL_BLACKLIST = ['ì¬ë²”êµ°ì£¼', 'ë¹…ì‚¬ë•…', 'ì¹¼ë¦¬', 'ì›í', 'ì•„ì´ì— ì†”ì´'];
        
        let appData = { 
            guilds: [], members: {}, timeSlots: [], uploads: [], admins: [],
            logs: [], loginLogs: [], gistData: [], gistLastSync: null,
            blacklist: [], renameHistory: [], superAdminPwHash: null,
            mainCharList: [], absentRecords: [],
            dateConfig: { startDate: '2025-12-23', endDate: '' },
            gistConfig: { token: '' }
        };
        
        let currentAdmin = null;
        let currentUploadFile = null;
        let currentMatchData = null;
        let pendingUploadData = null;
        let pieChart = null;
        let barChart = null;
        let selectedGuildFilter = '';
        let gistSyncTimer = null;
        let isDataLoaded = false;
        
        async function init() {
            showProcessing('ë°ì´í„° ë¡œë”© ì¤‘...');
            await loadData();
            await initSuperAdmin();
            checkAdminSession();
            setupEventListeners();
            updateAllSelects();
            renderAll();
            setDefaultDates();
            startGistAutoSync();
            hideProcessing();
            
            // ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™” ë¦¬ìŠ¤ë„ˆ
            setupRealtimeListener();
        }
        
        // Firebase ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ (ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ë³€ê²½ ê°ì§€)
        function setupRealtimeListener() {
            database.ref(DB_REF).on('value', (snapshot) => {
                if (!isDataLoaded) return; // ì´ˆê¸° ë¡œë“œ ì‹œ ë¬´ì‹œ
                const newData = snapshot.val();
                if (newData && JSON.stringify(newData) !== JSON.stringify(appData)) {
                    appData = newData;
                    renderAll();
                    if (currentAdmin) {
                        renderPendingUploads();
                    }
                }
            });
        }
        
        async function initSuperAdmin() {
            if (!appData.superAdminPwHash) {
                appData.superAdminPwHash = await sha256('tnals9328@@');
                await saveData();
            }
        }
        
        function setDefaultDates() {
            const startDate = appData.dateConfig?.startDate || '2025-12-23';
            let endDate = appData.dateConfig?.endDate;
            
            if (!endDate) {
                const now = new Date();
                const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000));
                endDate = koreaTime.toISOString().split('T')[0];
            }
            
            document.getElementById('filterStartDate').value = startDate;
            document.getElementById('filterEndDate').value = endDate;
            
            const configStart = document.getElementById('configStartDate');
            const configEnd = document.getElementById('configEndDate');
            if (configStart) configStart.value = appData.dateConfig?.startDate || '2025-12-23';
            if (configEnd) configEnd.value = appData.dateConfig?.endDate || '';
        }
        
        function saveDateConfig() {
            appData.dateConfig = {
                startDate: document.getElementById('configStartDate').value || '2025-12-23',
                endDate: document.getElementById('configEndDate').value || ''
            };
            saveData();
            setDefaultDates();
            showToast('ë‚ ì§œ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }
        
        async function loadData() {
            try {
                const snapshot = await database.ref(DB_REF).once('value');
                const saved = snapshot.val();
                
                if (saved) {
                    appData = saved;
                    if (!appData.blacklist) appData.blacklist = [...INITIAL_BLACKLIST];
                    if (!appData.renameHistory) appData.renameHistory = [];
                    if (!appData.loginLogs) appData.loginLogs = [];
                    if (!appData.mainCharList) appData.mainCharList = [];
                    if (!appData.absentRecords) appData.absentRecords = [];
                    if (!appData.dateConfig) appData.dateConfig = { startDate: '2025-12-23', endDate: '' };
                    if (!appData.gistConfig) appData.gistConfig = { token: '' };
                    if (!appData.uploads) appData.uploads = [];
                    if (!appData.gistData) appData.gistData = [];
                    if (!appData.logs) appData.logs = [];
                    if (!appData.admins) appData.admins = [];
                } else {
                    // ì´ˆê¸° ë°ì´í„° ì„¤ì •
                    appData.guilds = [...INITIAL_GUILDS];
                    appData.members = JSON.parse(JSON.stringify(INITIAL_MEMBERS));
                    appData.blacklist = [...INITIAL_BLACKLIST];
                    appData.dateConfig = { startDate: '2025-12-23', endDate: '' };
                    appData.gistConfig = { token: '' };
                    await saveData(); // ì´ˆê¸° ë°ì´í„° ì €ì¥
                }
                isDataLoaded = true;
            } catch (error) {
                console.error('Firebase ë¡œë“œ ì˜¤ë¥˜:', error);
                showToast('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.', 'error');
            }
        }
        
        async function saveData() {
            try {
                await database.ref(DB_REF).set(appData);
            } catch (error) {
                console.error('Firebase ì €ì¥ ì˜¤ë¥˜:', error);
                showToast('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨', 'error');
            }
        }
        
        // ==================== GIST TOKEN ====================
        function toggleTokenVisibility() {
            const input = document.getElementById('gistTokenInput');
            input.type = input.type === 'password' ? 'text' : 'password';
        }
        
        function saveGistToken() {
            const token = document.getElementById('gistTokenInput').value.trim();
            
            if (!token) { showToast('í† í°ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
            
            appData.gistConfig = {
                token: btoa(token) // Base64 ì¸ì½”ë”©
            };
            saveData();
            
            document.getElementById('gistTokenInput').value = '';
            updateTokenStatus();
            showToast('í† í°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. "ì§€ê¸ˆ ë™ê¸°í™”" ë²„íŠ¼ì„ ëˆŒëŸ¬ Gistë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”.', 'success');
        }
        
        function clearGistToken() {
            if (!confirm('í† í°ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            appData.gistConfig = { token: '' };
            saveData();
            updateTokenStatus();
            updateGistAutoStatus();
            showToast('í† í°ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'warning');
        }
        
        async function testGistConnection() {
            const token = document.getElementById('gistTokenInput').value.trim() || (appData.gistConfig.token ? atob(appData.gistConfig.token) : '');
            
            if (!token) {
                showToast('í† í°ì„ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }
            
            showProcessing('ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            try {
                const response = await fetch('https://api.github.com/gists?per_page=5', {
                    headers: {
                        'Accept': 'application/vnd.github.v3+json',
                        'Authorization': `token ${token}`
                    }
                });
                
                hideProcessing();
                
                if (response.ok) {
                    const gists = await response.json();
                    showToast(`ì—°ê²° ì„±ê³µ! ìµœê·¼ Gist ${gists.length}ê°œ í™•ì¸ë¨`, 'success');
                } else {
                    showToast(`ì—°ê²° ì‹¤íŒ¨: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                hideProcessing();
                showToast('ì—°ê²° ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        function updateTokenStatus() {
            const statusEl = document.getElementById('tokenStatus');
            const titleEl = document.getElementById('tokenStatusTitle');
            const textEl = document.getElementById('tokenStatusText');
            
            if (!statusEl) return;
            
            if (appData.gistConfig.token) {
                statusEl.className = 'token-status connected';
                titleEl.textContent = 'âœ“ í† í° ì„¤ì •ë¨';
                textEl.textContent = '15ë¶„ë§ˆë‹¤ ìë™ ìˆ˜ì§‘ ë˜ëŠ” "ì§€ê¸ˆ ë™ê¸°í™”" ë²„íŠ¼ìœ¼ë¡œ ìˆ˜ë™ ìˆ˜ì§‘';
            } else {
                statusEl.className = 'token-status disconnected';
                titleEl.textContent = 'í† í° ë¯¸ì„¤ì •';
                textEl.textContent = 'í† í°ì„ ì„¤ì •í•˜ë©´ Gist ìˆ˜ì§‘ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
            }
            
            updateGistSyncStats();
        }
        
        function updateGistSyncStats() {
            const container = document.getElementById('gistSyncStats');
            if (!container) return;
            
            const totalGistEntries = appData.gistData.length;
            const uniqueGists = new Set(appData.gistData.map(g => g.gistId)).size;
            const totalParticipants = appData.gistData.reduce((sum, g) => sum + (g.participants?.length || 0), 0);
            
            container.innerHTML = `
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;text-align:center;">
                    <div>
                        <div style="font-size:1.5rem;font-weight:700;color:var(--accent-cyan);">${uniqueGists}</div>
                        <div style="font-size:0.8rem;color:var(--text-secondary);">ìˆ˜ì§‘ëœ Gist</div>
                    </div>
                    <div>
                        <div style="font-size:1.5rem;font-weight:700;color:var(--accent-gold);">${totalGistEntries}</div>
                        <div style="font-size:0.8rem;color:var(--text-secondary);">ì´ ê¸°ë¡</div>
                    </div>
                    <div>
                        <div style="font-size:1.5rem;font-weight:700;color:var(--accent-purple);">${totalParticipants}</div>
                        <div style="font-size:0.8rem;color:var(--text-secondary);">ì°¸ì—¬ì ìˆ˜</div>
                    </div>
                </div>
                ${appData.gistLastSync ? `<p style="margin-top:10px;font-size:0.8rem;color:var(--text-secondary);text-align:center;">ë§ˆì§€ë§‰ ë™ê¸°í™”: ${new Date(appData.gistLastSync).toLocaleString('ko-KR')}</p>` : ''}
            `;
        }
        
        // ì§€ê¸ˆ ë™ê¸°í™” ë²„íŠ¼
        async function syncAllGistsNow() {
            if (!appData.gistConfig.token) {
                showToast('ë¨¼ì € í† í°ì„ ì €ì¥í•˜ì„¸ìš”', 'error');
                return;
            }
            
            showProcessing('ëª¨ë“  Gist ìˆ˜ì§‘ ì¤‘... (0%)');
            
            try {
                const token = atob(appData.gistConfig.token);
                let allGists = [];
                let page = 1;
                let hasMore = true;
                
                // ëª¨ë“  Gist í˜ì´ì§€ ê°€ì ¸ì˜¤ê¸°
                while (hasMore) {
                    document.getElementById('processingText').textContent = `Gist ëª©ë¡ ê°€ì ¸ì˜¤ëŠ” ì¤‘... (í˜ì´ì§€ ${page})`;
                    
                    const response = await fetch(`https://api.github.com/gists?per_page=100&page=${page}`, {
                        headers: {
                            'Accept': 'application/vnd.github.v3+json',
                            'Authorization': `token ${token}`
                        }
                    });
                    
                    if (!response.ok) throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
                    
                    const gists = await response.json();
                    if (gists.length === 0) {
                        hasMore = false;
                    } else {
                        allGists = allGists.concat(gists);
                        page++;
                        if (gists.length < 100) hasMore = false;
                    }
                }
                
                document.getElementById('processingText').textContent = `${allGists.length}ê°œ Gist ë¶„ì„ ì¤‘...`;
                
                // ì‹œì‘ì¼ í•„í„°
                const startDate = new Date(appData.dateConfig.startDate || '2025-12-23');
                
                let newEntries = 0;
                let skippedDuplicates = 0;
                let skippedInvalid = 0; // ìˆ«ì+ì  ë‹‰ë„¤ì„ìœ¼ë¡œ ì œì™¸ëœ Gist
                let processedGists = 0;
                
                // ê¸°ì¡´ ID ì„¸íŠ¸ (ì¤‘ë³µ ì²´í¬ìš©)
                const existingIds = new Set(appData.gistData.map(g => g.id));
                
                for (const gist of allGists) {
                    processedGists++;
                    document.getElementById('processingText').textContent = `Gist ë¶„ì„ ì¤‘... (${processedGists}/${allGists.length})`;
                    
                    // Gist ìƒì„¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
                    const detailResponse = await fetch(gist.url, {
                        headers: {
                            'Accept': 'application/vnd.github.v3+json',
                            'Authorization': `token ${token}`
                        }
                    });
                    
                    if (!detailResponse.ok) continue;
                    
                    const gistDetail = await detailResponse.json();
                    
                    // ê° íŒŒì¼ íŒŒì‹±
                    for (const [filename, fileData] of Object.entries(gistDetail.files)) {
                        const content = fileData.content;
                        if (!content) continue;
                        
                        // íŒŒì‹± ì „ ì›ë³¸ ì²´í¬ (ìˆ«ì+ì  íŒ¨í„´ì´ ìˆëŠ”ì§€ ë¯¸ë¦¬ í™•ì¸)
                        const hasNumberDotPattern = /\[\w+\]\d+\./.test(content);
                        if (hasNumberDotPattern) {
                            skippedInvalid++;
                            continue;
                        }
                        
                        const parsed = parseGistContent(content, filename, gist.id);
                        
                        for (const entry of parsed) {
                            // ë‚ ì§œ í•„í„°
                            const entryDate = new Date(entry.date);
                            if (entryDate < startDate) continue;
                            
                            // ì¤‘ë³µ ì²´í¬
                            if (existingIds.has(entry.id)) {
                                skippedDuplicates++;
                                continue;
                            }
                            
                            appData.gistData.push(entry);
                            existingIds.add(entry.id);
                            newEntries++;
                        }
                    }
                    
                    // Rate limit ë°©ì§€ë¥¼ ìœ„í•œ ì•½ê°„ì˜ ë”œë ˆì´
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                appData.gistLastSync = new Date().toISOString();
                saveData();
                
                hideProcessing();
                renderAll();
                updateGistSyncStats();
                
                showToast(`ë™ê¸°í™” ì™„ë£Œ! +${newEntries}ê°œ (ì¤‘ë³µ ${skippedDuplicates}, ì œì™¸ ${skippedInvalid})`, 'success');
                
            } catch (error) {
                hideProcessing();
                showToast('ë™ê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // ==================== GIST AUTO SYNC ====================
        function startGistAutoSync() {
            if (appData.gistConfig.token) {
                syncGist();
                gistSyncTimer = setInterval(syncGist, GIST_SYNC_INTERVAL);
            }
            updateGistAutoStatus();
        }
        
        async function syncGist() {
            if (!appData.gistConfig.token) {
                updateGistAutoStatus();
                return;
            }
            
            updateGistAutoStatus('ìë™ ë™ê¸°í™” ì¤‘...');
            
            try {
                const token = atob(appData.gistConfig.token);
                
                // ìµœê·¼ Gistë§Œ ì²´í¬ (ìë™ ë™ê¸°í™”ëŠ” ê°€ë²¼ì›Œì•¼ í•¨)
                const response = await fetch('https://api.github.com/gists?per_page=10', {
                    headers: {
                        'Accept': 'application/vnd.github.v3+json',
                        'Authorization': `token ${token}`
                    }
                });
                
                if (!response.ok) throw new Error('API ì˜¤ë¥˜');
                
                const gists = await response.json();
                const startDate = new Date(appData.dateConfig.startDate || '2025-12-23');
                const existingIds = new Set(appData.gistData.map(g => g.id));
                
                let newEntries = 0;
                
                for (const gist of gists) {
                    const detailResponse = await fetch(gist.url, {
                        headers: {
                            'Accept': 'application/vnd.github.v3+json',
                            'Authorization': `token ${token}`
                        }
                    });
                    
                    if (!detailResponse.ok) continue;
                    
                    const gistDetail = await detailResponse.json();
                    
                    for (const [filename, fileData] of Object.entries(gistDetail.files)) {
                        const content = fileData.content;
                        if (!content) continue;
                        
                        // ìˆ«ì+ì  íŒ¨í„´ì´ ìˆëŠ” Gist ì œì™¸
                        const hasNumberDotPattern = /\[\w+\]\d+\./.test(content);
                        if (hasNumberDotPattern) continue;
                        
                        const parsed = parseGistContent(content, filename, gist.id);
                        
                        for (const entry of parsed) {
                            const entryDate = new Date(entry.date);
                            if (entryDate < startDate) continue;
                            if (existingIds.has(entry.id)) continue;
                            
                            appData.gistData.push(entry);
                            existingIds.add(entry.id);
                            newEntries++;
                        }
                    }
                }
                
                if (newEntries > 0) {
                    saveData();
                    renderAll();
                }
                
                appData.gistLastSync = new Date().toISOString();
                saveData();
                updateGistAutoStatus(`ë§ˆì§€ë§‰: ${new Date().toLocaleTimeString('ko-KR')} (+${newEntries})`);
                
            } catch (error) {
                updateGistAutoStatus(`ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        function updateGistAutoStatus(text) {
            const statusEl = document.getElementById('gistAutoStatus');
            const textEl = document.getElementById('gistAutoStatusText');
            
            if (!statusEl || !textEl) return;
            
            if (appData.gistConfig.token) {
                statusEl.className = 'gist-auto-status active';
                textEl.textContent = text || `15ë¶„ë§ˆë‹¤ ìë™ ìˆ˜ì§‘ (ë§ˆì§€ë§‰: ${appData.gistLastSync ? new Date(appData.gistLastSync).toLocaleTimeString('ko-KR') : 'ì—†ìŒ'})`;
            } else {
                statusEl.className = 'gist-auto-status inactive';
                textEl.textContent = 'í† í° ë¯¸ì„¤ì • - ê´€ë¦¬ì íŒ¨ë„ì—ì„œ ì„¤ì •í•˜ì„¸ìš”';
            }
        }
        
        function parseGistContent(content, filename, gistId) {
            const results = [];
            const lines = content.split('\n');
            
            let inRegisteredSection = false;
            let currentUploader = null;
            let currentDate = null;
            let currentTime = null;
            let currentParticipants = [];
            let entryId = null;
            
            // ìˆ«ì+ì  íŒ¨í„´ ì²´í¬ (ì˜ˆ: "1.", "2.", "10." ë“±)
            const isInvalidNickname = (name) => /^\d+\.$/.test(name);
            
            // ë“±ë¡ëœ ë‹‰ë„¤ì„ì¸ì§€ ì²´í¬
            const isRegisteredNickname = (guild, name) => {
                return appData.members[guild] && appData.members[guild].includes(name);
            };
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                const dateMatch = line.match(/^(\d{4}-\d{2}-\d{2})/);
                if (dateMatch) {
                    if (currentParticipants.length > 0 && currentUploader && currentDate) {
                        // ìˆ«ì+ì  ë‹‰ë„¤ì„ì´ ìˆëŠ”ì§€ ì²´í¬
                        const hasInvalidNick = currentParticipants.some(p => isInvalidNickname(p.name));
                        
                        if (!hasInvalidNick) {
                            // ê³ ìœ  ID: gistId + ë‚ ì§œ + ì‹œê°„ + ì—…ë¡œë”
                            const uniqueId = `${gistId}_${currentDate}_${currentTime || 'notime'}_${currentUploader.nickname}`;
                            results.push({
                                id: uniqueId,
                                gistId: gistId,
                                type: 'gist',
                                uploader: currentUploader,
                                date: currentDate,
                                timeSlot: currentTime,
                                participants: [...currentParticipants],
                                source: filename
                            });
                        }
                    }
                    
                    currentDate = dateMatch[1];
                    currentParticipants = [];
                    currentUploader = null;
                    currentTime = null;
                    inRegisteredSection = false;
                    continue;
                }
                
                const timeMatch = line.match(/(\d{1,2}:\d{2})\s*(ë³´íƒ|ì‹œ)/i);
                if (timeMatch) currentTime = timeMatch[0];
                
                const creatorMatch = line.match(/ìƒì„±ì\s*:\s*\[([^\]]+)\]([^\(]+)(?:\(([^\)]+)\))?/);
                if (creatorMatch) {
                    const guild = creatorMatch[1];
                    const mainNick = creatorMatch[2].trim();
                    const uploaderNick = creatorMatch[3] ? creatorMatch[3].trim() : mainNick;
                    currentUploader = { guild, nickname: uploaderNick, displayName: mainNick };
                }
                
                if (line.includes('[ë“±ë¡ëœ ë‹‰ë„¤ì„]')) { inRegisteredSection = true; continue; }
                if (line.includes('[ë¯¸ë“±ë¡') || line.includes('---')) { inRegisteredSection = false; continue; }
                
                if (inRegisteredSection) {
                    const nickMatches = line.matchAll(/\[([^\]]+)\]([^\[\s,]+)/g);
                    for (const match of nickMatches) {
                        const guild = match[1];
                        const name = match[2].trim();
                        // ë“±ë¡ëœ ë‹‰ë„¤ì„ë§Œ ì¶”ê°€
                        if (name && appData.guilds.includes(guild) && isRegisteredNickname(guild, name)) {
                            currentParticipants.push({ guild, name });
                        }
                    }
                }
            }
            
            // ë§ˆì§€ë§‰ ì—”íŠ¸ë¦¬ ì²˜ë¦¬
            if (currentParticipants.length > 0 && currentUploader && currentDate) {
                // ìˆ«ì+ì  ë‹‰ë„¤ì„ì´ ìˆëŠ”ì§€ ì²´í¬
                const hasInvalidNick = currentParticipants.some(p => isInvalidNickname(p.name));
                
                if (!hasInvalidNick) {
                    const uniqueId = `${gistId}_${currentDate}_${currentTime || 'notime'}_${currentUploader.nickname}`;
                    results.push({
                        id: uniqueId,
                        gistId: gistId,
                        type: 'gist',
                        uploader: currentUploader,
                        date: currentDate,
                        timeSlot: currentTime,
                        participants: [...currentParticipants],
                        source: filename
                    });
                }
            }
            
            return results;
        }
        
        // ==================== SESSION ====================
        function checkAdminSession() {
            const session = localStorage.getItem('adminSession');
            if (session) {
                const data = JSON.parse(session);
                if (data.remember || Date.now() - data.time < 3600000) {
                    currentAdmin = data.admin;
                    showAdminUI();
                }
            }
        }
        
        function setupEventListeners() {
            document.querySelectorAll('.nav-tab[data-panel]').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.nav-tab[data-panel]').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById('panel-' + tab.dataset.panel).classList.add('active');
                });
            });
            
            document.querySelectorAll('.nav-tab[data-admin-panel]').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.nav-tab[data-admin-panel]').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.admin-panel').forEach(p => p.style.display = 'none');
                    tab.classList.add('active');
                    document.getElementById('admin-' + tab.dataset.adminPanel).style.display = 'block';
                });
            });
            
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');
            
            uploadZone.addEventListener('click', () => fileInput.click());
            uploadZone.addEventListener('dragover', (e) => { e.preventDefault(); uploadZone.classList.add('dragover'); });
            uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) handleFileSelect(file);
            });
            
            fileInput.addEventListener('change', (e) => { if (e.target.files[0]) handleFileSelect(e.target.files[0]); });
            document.getElementById('submitUpload').addEventListener('click', showConfirmModal);
            document.getElementById('loginPw').addEventListener('keypress', (e) => { if (e.key === 'Enter') adminLogin(); });
            
            // í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.getElementById('confirmSubmitBtn').addEventListener('click', confirmSubmit);
            
            document.addEventListener('paste', (e) => {
                const items = e.clipboardData?.items;
                if (!items) return;
                for (const item of items) {
                    if (item.type.startsWith('image/')) {
                        const file = item.getAsFile();
                        if (file) {
                            handleFileSelect(file);
                            showToast('ì´ë¯¸ì§€ê°€ ë¶™ì—¬ë„£ê¸° ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                        }
                        break;
                    }
                }
            });
        }
        
        function updateAllSelects() {
            updateTimeSlotOptions();
            updateFilterTimeOptions();
            updateGuildSelects();
            updateMainCharSelect();
        }
        
        function renderAll() {
            renderTop3Display();
            renderUploadFeed();
            renderHomeTopRanking();
            renderRecentUploads();
            renderGuildFilterChips();
            renderStats();
            updateHomeSummary();
            renderBlacklist();
            renderRenameHistory();
            renderAbsentStats();
            renderMainCharList();
            updateGistAutoStatus();
        }
        
        // ==================== CONFIRM MODAL ====================
        function showConfirmModal() {
            const nickname = document.getElementById('uploaderNickname').value.trim();
            const time = document.getElementById('participationTime').value;
            const absentChar = document.getElementById('absentMainChar').value;
            
            if (!nickname) { showToast('ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
            if (!time) { showToast('ì°¸ì—¬ ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”', 'error'); return; }
            if (!currentUploadFile) { showToast('ìŠ¤í¬ë¦°ìƒ·ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”!', 'error'); return; }
            
            pendingUploadData = { nickname, time, absentChar };
            
            document.getElementById('confirmContent').innerHTML = `
                <div class="confirm-item">
                    <span class="confirm-label">ë‹‰ë„¤ì„</span>
                    <span class="confirm-value">${nickname}</span>
                </div>
                <div class="confirm-item">
                    <span class="confirm-label">ì°¸ì—¬ ì‹œê°„</span>
                    <span class="confirm-value">${time}</span>
                </div>
                ${absentChar ? `
                <div class="confirm-item">
                    <span class="confirm-label">ë©”ì¸ìº ë¯¸ì°¸ì—¬</span>
                    <span class="confirm-value" style="color:var(--accent-purple);">${absentChar}</span>
                </div>
                ` : ''}
                <div class="confirm-item">
                    <span class="confirm-label">ìŠ¤í¬ë¦°ìƒ·</span>
                    <span class="confirm-value">ì²¨ë¶€ë¨ âœ“</span>
                </div>
            `;
            
            document.getElementById('confirmModal').classList.add('active');
        }
        
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
            pendingUploadData = null;
        }
        
        async function confirmSubmit() {
            if (!pendingUploadData) {
                showToast('ë°ì´í„° ì˜¤ë¥˜', 'error');
                return;
            }
            
            closeConfirmModal();
            await submitUpload();
        }
        
        // ==================== UPLOAD ====================
        function handleFileSelect(file) {
            currentUploadFile = file;
            const preview = document.getElementById('uploadPreview');
            const reader = new FileReader();
            reader.onload = (e) => { preview.src = e.target.result; preview.style.display = 'block'; };
            reader.readAsDataURL(file);
            document.getElementById('uploadZone').classList.add('has-file');
        }
        
        async function submitUpload() {
            if (!pendingUploadData) return;
            
            const { nickname, time, absentChar } = pendingUploadData;
            const description = document.getElementById('uploadDescription').value.trim();
            
            showProcessing('ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...');
            
            try {
                const imageHash = await getImageHash(currentUploadFile);
                if (appData.uploads.some(u => u.imageHash === imageHash)) {
                    hideProcessing();
                    showToast('ì´ë¯¸ ë“±ë¡ëœ ìŠ¤í¬ë¦°ìƒ·ì…ë‹ˆë‹¤', 'warning');
                    return;
                }
                
                const imageData = await fileToBase64(currentUploadFile);
                const ip = await getUserIP();
                const extractedNames = await extractNicknames(currentUploadFile);
                
                const upload = {
                    id: Date.now().toString(),
                    uploaderNickname: nickname,
                    timeSlot: time,
                    absentMainChar: absentChar || null,
                    description,
                    imageData,
                    imageHash,
                    extractedNames,
                    matchedNames: [],
                    status: 'pending',
                    uploadDate: new Date().toISOString(),
                    ip
                };
                
                appData.uploads.push(upload);
                
                if (absentChar) {
                    appData.absentRecords.push({
                        id: Date.now().toString(),
                        mainChar: absentChar,
                        uploader: nickname,
                        date: new Date().toISOString(),
                        timeSlot: time
                    });
                }
                
                appData.logs.push({
                    id: Date.now().toString(),
                    action: 'upload',
                    uploaderNickname: nickname,
                    timeSlot: time,
                    absentMainChar: absentChar || null,
                    ip,
                    date: new Date().toISOString(),
                    extractedCount: extractedNames.length
                });
                
                saveData();
                hideProcessing();
                
                showToast('ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('uploaderNickname').value = '';
                document.getElementById('participationTime').value = '';
                document.getElementById('absentMainChar').value = '';
                document.getElementById('uploadDescription').value = '';
                document.getElementById('uploadPreview').style.display = 'none';
                document.getElementById('uploadZone').classList.remove('has-file');
                currentUploadFile = null;
                pendingUploadData = null;
                
                renderAll();
                if (currentAdmin) renderPendingUploads();
                
                // í†µê³„ í˜„í™©ìœ¼ë¡œ ì´ë™
                document.querySelector('.nav-tab[data-panel="stats"]').click();
                
            } catch (error) {
                hideProcessing();
                showToast('ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }
        
        async function extractNicknames(file) {
            return new Promise((resolve, reject) => {
                Tesseract.recognize(file, 'kor+eng', {
                    logger: m => {
                        if (m.status === 'recognizing text') {
                            document.getElementById('processingText').textContent = `ë¶„ì„ ì¤‘... ${Math.round(m.progress * 100)}%`;
                        }
                    }
                }).then(({ data: { text } }) => {
                    const lines = text.split('\n').map(l => l.trim()).filter(l => l);
                    const nicknames = new Set();
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i];
                        const nextLine = lines[i + 1] || '';
                        
                        if (nextLine.match(/^Lv\.?\s*\d+/i)) {
                            const cleanName = line.replace(/[^\wê°€-í£a-zA-Z0-9]/g, '').trim();
                            if (cleanName.length >= 2 && cleanName.length <= 20) nicknames.add(cleanName);
                        }
                        
                        const sameLine = line.match(/^(.+?)\s*Lv\.?\s*\d+/i);
                        if (sameLine) {
                            const cleanName = sameLine[1].replace(/[^\wê°€-í£a-zA-Z0-9]/g, '').trim();
                            if (cleanName.length >= 2 && cleanName.length <= 20) nicknames.add(cleanName);
                        }
                    }
                    resolve(Array.from(nicknames));
                }).catch(reject);
            });
        }
        
        // ==================== MAIN CHAR ====================
        function addMainChar() {
            const name = document.getElementById('newMainChar').value.trim();
            if (!name) { showToast('ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
            if (appData.mainCharList.includes(name)) { showToast('ì´ë¯¸ ë“±ë¡ë¨', 'warning'); return; }
            appData.mainCharList.push(name);
            saveData();
            document.getElementById('newMainChar').value = '';
            renderMainCharList();
            updateMainCharSelect();
            showToast('ì¶”ê°€ë¨', 'success');
        }
        
        function removeMainChar(name) {
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            appData.mainCharList = appData.mainCharList.filter(n => n !== name);
            saveData();
            renderMainCharList();
            updateMainCharSelect();
            showToast('ì‚­ì œë¨', 'warning');
        }
        
        function renderMainCharList() {
            const container = document.getElementById('mainCharListContainer');
            if (!container) return;
            
            if (!appData.mainCharList.length) {
                container.innerHTML = '<div class="empty-state"><p>ë“±ë¡ëœ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            
            container.innerHTML = `
                <p style="color:var(--text-secondary);margin-bottom:10px;">ì´ ${appData.mainCharList.length}ëª…</p>
                <div class="tag-input-container">
                    ${appData.mainCharList.map(name => `
                        <div class="tag-item" style="border-color:var(--accent-purple);">
                            <span style="color:var(--accent-purple);">${name}</span>
                            <span class="tag-remove" onclick="removeMainChar('${name}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function updateMainCharSelect() {
            const select = document.getElementById('absentMainChar');
            if (!select) return;
            select.innerHTML = '<option value="">ë¯¸ì°¸ì—¬ ìºë¦­í„° ì—†ìŒ</option>' +
                appData.mainCharList.map(name => `<option value="${name}">${name}</option>`).join('');
        }
        
        function renderAbsentStats() {
            const container = document.getElementById('absentStatsContainer');
            if (!container) return;
            
            if (!appData.absentRecords.length) {
                container.innerHTML = '<div class="empty-state"><p>ë¯¸ì°¸ì—¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            
            const stats = {};
            appData.absentRecords.forEach(r => {
                if (!stats[r.mainChar]) stats[r.mainChar] = [];
                stats[r.mainChar].push(r);
            });
            
            const sorted = Object.entries(stats).sort((a, b) => b[1].length - a[1].length);
            
            container.innerHTML = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ë©”ì¸ ìºë¦­í„°</th>
                                <th>ë¯¸ì°¸ì—¬ íšŸìˆ˜</th>
                                <th>ìµœê·¼ ë¯¸ì°¸ì—¬</th>
                                <th>ì—…ë¡œë”</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sorted.map(([name, records]) => `
                                <tr>
                                    <td><span class="badge badge-absent">${name}</span></td>
                                    <td style="color:var(--accent-purple);font-weight:700;">${records.length}íšŒ</td>
                                    <td>${new Date(records[records.length-1].date).toLocaleDateString('ko-KR')}</td>
                                    <td>${records[records.length-1].uploader}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // ==================== LOGIN ====================
        async function adminLogin() {
            const id = document.getElementById('loginId').value.trim();
            const pw = document.getElementById('loginPw').value;
            const remember = document.getElementById('loginRemember').checked;
            const ip = await getUserIP();
            
            const loginLog = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                userId: id,
                ip: ip,
                userAgent: navigator.userAgent,
                success: false,
                type: ''
            };
            
            const pwHash = await sha256(pw);
            
            if (id === SUPER_ADMIN_ID && pwHash === appData.superAdminPwHash) {
                currentAdmin = { id, type: 'super' };
                loginLog.success = true;
                loginLog.type = 'ìµœì¢…ê´€ë¦¬ì';
            } else {
                const admin = appData.admins.find(a => a.id === id && a.pwHash === pwHash);
                if (admin) {
                    currentAdmin = { id, type: 'normal' };
                    loginLog.success = true;
                    loginLog.type = 'ì¤‘ê°„ê´€ë¦¬ì';
                } else {
                    loginLog.success = false;
                    loginLog.type = 'ì‹¤íŒ¨';
                    appData.loginLogs.push(loginLog);
                    saveData();
                    showToast('ë¡œê·¸ì¸ ì‹¤íŒ¨', 'error');
                    return;
                }
            }
            
            appData.loginLogs.push(loginLog);
            saveData();
            
            localStorage.setItem('adminSession', JSON.stringify({ admin: currentAdmin, remember, time: Date.now() }));
            showToast('ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
            showAdminUI();
            document.querySelector('.nav-tab[data-panel="admin"]').click();
        }
        
        function adminLogout() {
            currentAdmin = null;
            localStorage.removeItem('adminSession');
            hideAdminUI();
            showToast('ë¡œê·¸ì•„ì›ƒ', 'success');
            document.querySelector('.nav-tab[data-panel="login"]').click();
        }
        
        function showAdminUI() {
            document.getElementById('adminTab').style.display = '';
            document.getElementById('loginTab').style.display = 'none';
            document.getElementById('adminUserDisplay').textContent = `${currentAdmin.id} (${currentAdmin.type === 'super' ? 'ìµœì¢…' : 'ì¤‘ê°„'}ê´€ë¦¬ì)`;
            if (currentAdmin.type === 'super') {
                document.getElementById('superAdminTab').style.display = '';
                document.getElementById('gistTokenTab').style.display = '';
            }
            
            renderPendingUploads();
            renderBlacklist();
            renderRenameHistory();
            renderGuildList();
            renderNicknameList();
            renderTimeSlotList();
            renderLogs();
            renderLoginLogs();
            renderAdminList();
            renderMainCharList();
            updateTokenStatus();
            updateGistSyncStats();
            setDefaultDates();
        }
        
        function hideAdminUI() {
            document.getElementById('adminTab').style.display = 'none';
            document.getElementById('loginTab').style.display = '';
            document.getElementById('superAdminTab').style.display = 'none';
            document.getElementById('gistTokenTab').style.display = 'none';
        }
        
        function renderLoginLogs() {
            const container = document.getElementById('loginLogsContainer');
            if (!container) return;
            if (!appData.loginLogs?.length) {
                container.innerHTML = '<div class="empty-state"><p>ë¡œê·¸ì¸ ë¡œê·¸ ì—†ìŒ</p></div>';
                return;
            }
            
            const logs = [...appData.loginLogs].reverse().slice(0, 200);
            container.innerHTML = `<table class="data-table"><thead><tr><th>ì‹œê°„</th><th>ì•„ì´ë””</th><th>ê²°ê³¼</th><th>íƒ€ì…</th><th>IP</th></tr></thead><tbody>${logs.map(l => `
                <tr>
                    <td>${new Date(l.date).toLocaleString('ko-KR')}</td>
                    <td>${l.userId}</td>
                    <td class="${l.success ? 'log-success' : 'log-fail'}">${l.success ? 'âœ“ ì„±ê³µ' : 'âœ• ì‹¤íŒ¨'}</td>
                    <td>${l.type}</td>
                    <td style="font-family:monospace;font-size:0.8rem;">${l.ip}</td>
                </tr>
            `).join('')}</tbody></table>`;
        }
        
        // ==================== TOP 3 ====================
        function renderTop3Display() {
            const { participation } = calculateParticipation();
            const entries = Object.entries(participation)
                .map(([key, data]) => {
                    const [guild, name] = key.split('|||');
                    return { guild, name, total: data.total };
                })
                .sort((a, b) => b.total - a.total)
                .slice(0, 3);
            
            for (let i = 0; i < 3; i++) {
                const nameEl = document.getElementById(`top3Name${i + 1}`);
                const countEl = document.getElementById(`top3Count${i + 1}`);
                
                if (entries[i]) {
                    nameEl.innerHTML = `<span class="guild-badge guild-${entries[i].guild}">${entries[i].guild}</span>${entries[i].name}`;
                    countEl.textContent = `${entries[i].total}íšŒ`;
                } else {
                    nameEl.textContent = '-';
                    countEl.textContent = '0íšŒ';
                }
            }
        }
        
        // ==================== BLACKLIST ====================
        function isBlacklisted(name) { return appData.blacklist.includes(name); }
        
        function addBlacklist() {
            const name = document.getElementById('newBlacklist').value.trim();
            if (!name) { showToast('ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
            if (appData.blacklist.includes(name)) { showToast('ì´ë¯¸ ë“±ë¡ë¨', 'warning'); return; }
            appData.blacklist.push(name);
            saveData();
            document.getElementById('newBlacklist').value = '';
            renderBlacklist();
            renderAll();
            showToast('ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë¨', 'success');
        }
        
        function removeBlacklist(name) {
            if (!confirm(`'${name}'ì„(ë¥¼) ë¸”ë™ë¦¬ìŠ¤íŠ¸ì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            appData.blacklist = appData.blacklist.filter(n => n !== name);
            saveData();
            renderBlacklist();
            renderAll();
            showToast('ë¸”ë™ë¦¬ìŠ¤íŠ¸ì—ì„œ ì œê±°ë¨', 'warning');
        }
        
        function renderBlacklist() {
            const container = document.getElementById('blacklistContainer');
            if (!container) return;
            
            if (!appData.blacklist.length) {
                container.innerHTML = '<div class="empty-state"><p>ë¸”ë™ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            
            container.innerHTML = `
                <p style="color:var(--text-secondary);margin-bottom:10px;">ì´ ${appData.blacklist.length}ëª…</p>
                <div class="tag-input-container">
                    ${appData.blacklist.map(name => `
                        <div class="tag-item" style="border-color:var(--danger);">
                            <span style="color:var(--danger);">${name}</span>
                            <span class="tag-remove" onclick="removeBlacklist('${name}')">Ã—</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // ==================== RENAME ====================
        function renameNickname() {
            const oldNick = document.getElementById('renameOldNick').value.trim();
            const newNick = document.getElementById('renameNewNick').value.trim();
            
            if (!oldNick || !newNick) { showToast('ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”', 'error'); return; }
            if (oldNick === newNick) { showToast('ê¸°ì¡´ê³¼ ë™ì¼í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤', 'warning'); return; }
            
            let foundGuild = null;
            for (const guild of appData.guilds) {
                const idx = (appData.members[guild] || []).indexOf(oldNick);
                if (idx > -1) {
                    foundGuild = guild;
                    appData.members[guild][idx] = newNick;
                    break;
                }
            }
            
            let changed = 0;
            appData.uploads.forEach(u => {
                if (u.matchedNames) {
                    u.matchedNames = u.matchedNames.map(m => {
                        if (m.name === oldNick) { changed++; return { ...m, name: newNick }; }
                        return m;
                    });
                }
            });
            
            appData.gistData.forEach(g => {
                if (g.participants) {
                    g.participants = g.participants.map(p => {
                        if (p.name === oldNick) { changed++; return { ...p, name: newNick }; }
                        return p;
                    });
                }
            });
            
            appData.renameHistory.push({
                oldNick, newNick, guild: foundGuild,
                date: new Date().toISOString(),
                recordsChanged: changed
            });
            
            saveData();
            document.getElementById('renameOldNick').value = '';
            document.getElementById('renameNewNick').value = '';
            renderAll();
            renderNicknameList();
            showToast(`ë‹‰ë„¤ì„ ë³€ê²½ ì™„ë£Œ! (${changed}ê±´ ê¸°ë¡ ì´ì „)`, 'success');
        }
        
        function renderRenameHistory() {
            const container = document.getElementById('renameHistoryContainer');
            if (!container) return;
            
            if (!appData.renameHistory?.length) {
                container.innerHTML = '<div class="empty-state"><p>ë³€ê²½ ì´ë ¥ ì—†ìŒ</p></div>';
                return;
            }
            
            const history = [...appData.renameHistory].reverse();
            container.innerHTML = history.map(h => `
                <div class="feed-item">
                    <div class="feed-info">
                        <span class="feed-uploader">
                            ${h.guild ? `<span class="guild-badge guild-${h.guild}">${h.guild}</span>` : ''}
                            <span style="color:var(--danger);text-decoration:line-through;">${h.oldNick}</span>
                            â†’ <span style="color:var(--success);">${h.newNick}</span>
                        </span>
                        <div class="feed-meta">${new Date(h.date).toLocaleString('ko-KR')} | ${h.recordsChanged}ê±´ ì´ì „</div>
                    </div>
                </div>
            `).join('');
        }
        
        // ==================== HOME ====================
        function updateHomeSummary() {
            const allData = getAllParticipationData();
            const uniqueMembers = new Set();
            let totalCount = 0;
            
            allData.forEach(item => {
                item.participants.forEach(p => {
                    if (!isBlacklisted(p.name)) {
                        uniqueMembers.add(`${p.guild}_${p.name}`);
                        totalCount++;
                    }
                });
            });
            
            const approvedUploads = appData.uploads.filter(u => u.status === 'approved').length + appData.gistData.length;
            
            document.getElementById('homeTotalMembers').textContent = uniqueMembers.size;
            document.getElementById('homeTotalCount').textContent = totalCount;
            document.getElementById('homeUploads').textContent = approvedUploads;
        }
        
        function renderUploadFeed() {
            const container = document.getElementById('uploadFeed');
            if (!container) return;
            
            const allItems = [];
            
            appData.uploads.forEach(u => {
                allItems.push({
                    type: 'upload', uploader: u.uploaderNickname, date: u.uploadDate,
                    timeSlot: u.timeSlot, status: u.status, imageData: u.imageData,
                    count: u.matchedNames?.length || 0
                });
            });
            
            appData.gistData.forEach(g => {
                allItems.push({
                    type: 'gist', uploader: `[${g.uploader.guild}] ${g.uploader.nickname}`,
                    date: g.date, timeSlot: g.timeSlot, status: 'gist',
                    count: g.participants.length
                });
            });
            
            allItems.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (!allItems.length) {
                container.innerHTML = '<div class="empty-state"><p>ì—…ë¡œë“œ ë‚´ì—­ ì—†ìŒ</p></div>';
                return;
            }
            
            container.innerHTML = allItems.slice(0, 20).map(item => {
                let statusHtml = '';
                if (item.status === 'pending') statusHtml = '<span class="status-indicator pending"><span class="status-dot pending"></span>ìŠ¹ì¸ ëŒ€ê¸°</span>';
                else if (item.status === 'approved') statusHtml = '<span class="status-indicator approved"><span class="status-dot approved"></span>í†µê³„ ë°˜ì˜</span>';
                else if (item.status === 'gist') statusHtml = '<span class="status-indicator gist"><span class="status-dot gist"></span>ìë™ ìˆ˜ì§‘</span>';
                else if (item.status === 'rejected') statusHtml = '<span class="badge badge-rejected">ê±°ì ˆ</span>';
                
                return `
                    <div class="feed-item">
                        <div class="feed-info">
                            <span class="feed-uploader">${item.uploader}</span>
                            ${statusHtml}
                            <div class="feed-meta">${new Date(item.date).toLocaleString('ko-KR')} | ${item.timeSlot || '-'} | ${item.count}ëª…</div>
                        </div>
                        ${item.imageData ? `<img src="${item.imageData}" class="feed-thumb" onclick="showImageModal('${item.imageData}')">` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function renderHomeTopRanking() {
            const container = document.getElementById('homeTopRanking');
            if (!container) return;
            
            const { participation } = calculateParticipation();
            const entries = Object.entries(participation)
                .map(([key, data]) => {
                    const [guild, name] = key.split('|||');
                    return { guild, name, total: data.total };
                })
                .sort((a, b) => b.total - a.total)
                .slice(0, 10);
            
            if (!entries.length) {
                container.innerHTML = '<div class="empty-state"><p>ë°ì´í„° ì—†ìŒ</p></div>';
                return;
            }
            
            container.innerHTML = entries.map((e, i) => `
                <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg-secondary);border-radius:8px;margin-bottom:8px;${i < 3 ? 'border-left:3px solid ' + (i === 0 ? '#ffd700' : i === 1 ? '#c0c0c0' : '#cd7f32') : ''}">
                    <span class="rank-badge ${i < 3 ? 'rank-'+(i+1) : 'rank-other'}">${i+1}</span>
                    <span class="guild-badge guild-${e.guild}">${e.guild}</span>
                    <span style="flex:1;font-weight:500;">${e.name}</span>
                    <span style="color:var(--accent-gold);font-weight:700;">${e.total}íšŒ</span>
                </div>
            `).join('');
        }
        
        // ==================== PARTICIPATION ====================
        function getAllParticipationData() {
            const data = [];
            
            appData.uploads.filter(u => u.status === 'approved').forEach(u => {
                data.push({ type: 'upload', date: u.uploadDate, timeSlot: u.timeSlot, participants: u.matchedNames || [] });
            });
            
            // gistDataëŠ” ì´ë¯¸ ìˆ˜ì§‘ ì‹œì ì— ë‚ ì§œ í•„í„° ì ìš©ë¨
            appData.gistData.forEach(g => {
                data.push({ type: 'gist', date: g.date, timeSlot: g.timeSlot, participants: g.participants || [] });
            });
            
            return data;
        }
        
        function calculateParticipation(filterGuild = '', startDate = null, endDate = null, timeFilter = '') {
            const participation = {};
            const allData = getAllParticipationData();
            
            // ê²Œí—¨ë‚˜/í•„ë“œìŸ ì´ íšŸìˆ˜ ê³„ì‚°ìš©
            let gehennaTotalRounds = 0;
            let fieldTotalRounds = 0;
            
            allData.forEach(item => {
                const itemDate = new Date(item.date);
                
                if (startDate && itemDate < new Date(startDate)) return;
                if (endDate) {
                    const end = new Date(endDate);
                    end.setDate(end.getDate() + 1);
                    if (itemDate >= end) return;
                }
                if (timeFilter && item.timeSlot && !item.timeSlot.includes(timeFilter)) return;
                
                // ê²Œí—¨ë‚˜/í•„ë“œìŸ ë¼ìš´ë“œ ìˆ˜ ì¹´ìš´íŠ¸
                if (item.type === 'gist') {
                    gehennaTotalRounds++;
                } else {
                    fieldTotalRounds++;
                }
                
                item.participants.forEach(p => {
                    if (isBlacklisted(p.name)) return;
                    if (filterGuild && p.guild !== filterGuild) return;
                    
                    const key = `${p.guild}|||${p.name}`;
                    if (!participation[key]) {
                        participation[key] = { total: 0, gehenna: 0, field: 0 };
                    }
                    participation[key].total++;
                    
                    if (item.type === 'gist') {
                        participation[key].gehenna++;
                    } else {
                        participation[key].field++;
                    }
                });
            });
            
            return { participation, gehennaTotalRounds, fieldTotalRounds };
        }
        
        // ==================== PENDING ====================
        function renderPendingUploads() {
            const container = document.getElementById('pendingContainer');
            if (!container) return;
            const pending = appData.uploads.filter(u => u.status === 'pending');
            
            if (!pending.length) {
                container.innerHTML = '<div class="empty-state"><p>ëŒ€ê¸° í•­ëª© ì—†ìŒ</p></div>';
                return;
            }
            
            container.innerHTML = pending.map(upload => {
                const matchResults = upload.extractedNames.map(name => ({ extracted: name, match: findSimilarNickname(name) }));
                return `
                    <div class="card" style="margin-bottom:15px;">
                        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:15px;">
                            <div>
                                <strong>${upload.uploaderNickname}</strong>
                                <span class="badge badge-pending" style="margin-left:10px;">ìŠ¹ì¸ ëŒ€ê¸°</span>
                                ${upload.absentMainChar ? `<span class="badge badge-absent" style="margin-left:5px;">ë¯¸ì°¸ì—¬: ${upload.absentMainChar}</span>` : ''}
                                <p style="color:var(--text-secondary);font-size:0.85rem;margin-top:5px;">
                                    ${upload.timeSlot} | ${new Date(upload.uploadDate).toLocaleString('ko-KR')}
                                </p>
                            </div>
                            <img src="${upload.imageData}" style="width:100px;height:60px;object-fit:cover;border-radius:8px;cursor:pointer;border:1px solid var(--border-color);" onclick="showImageModal('${upload.imageData}')">
                        </div>
                        <div style="margin-bottom:15px;">
                            <p style="font-size:0.85rem;color:var(--text-secondary);margin-bottom:8px;">OCR ì¸ì‹ (${upload.extractedNames.length}ëª…):</p>
                            <div>${matchResults.map(r => `<span class="name-tag ${r.match ? 'matched' : 'unmatched'}">${r.extracted} ${r.match ? `â†’ [${r.match.guild}] ${r.match.match}` : '(ë¯¸ë“±ë¡)'}</span>`).join('')}</div>
                        </div>
                        <div style="display:flex;gap:10px;">
                            <button class="btn btn-success btn-sm" onclick="approveUpload('${upload.id}')">ìŠ¹ì¸</button>
                            <button class="btn btn-secondary btn-sm" onclick="openMatchModal('${upload.id}')">ìˆ˜ì •</button>
                            <button class="btn btn-danger btn-sm" onclick="rejectUpload('${upload.id}')">ê±°ì ˆ</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function approveUpload(id) {
            const upload = appData.uploads.find(u => u.id === id);
            if (!upload) return;
            
            const matchedNames = [];
            upload.extractedNames.forEach(name => {
                const match = findSimilarNickname(name);
                if (match) matchedNames.push({ guild: match.guild, name: match.match });
            });
            
            upload.matchedNames = matchedNames.filter((v, i, a) => a.findIndex(t => t.name === v.name) === i);
            upload.status = 'approved';
            upload.approvedBy = currentAdmin.id;
            upload.approvedDate = new Date().toISOString();
            
            saveData();
            renderPendingUploads();
            renderAll();
            showToast(`ìŠ¹ì¸! ${upload.matchedNames.length}ëª… ë°˜ì˜`, 'success');
        }
        
        function rejectUpload(id) {
            if (!confirm('ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            const upload = appData.uploads.find(u => u.id === id);
            if (upload) {
                upload.status = 'rejected';
                upload.rejectedBy = currentAdmin.id;
                saveData();
                renderPendingUploads();
                renderAll();
                showToast('ê±°ì ˆë¨', 'warning');
            }
        }
        
        function openMatchModal(id) {
            const upload = appData.uploads.find(u => u.id === id);
            if (!upload) return;
            
            currentMatchData = { uploadId: id, matches: {} };
            
            document.getElementById('matchResults').innerHTML = upload.extractedNames.map(name => {
                const match = findSimilarNickname(name);
                currentMatchData.matches[name] = match ? JSON.stringify({ guild: match.guild, name: match.match }) : '';
                return `
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                        <span style="min-width:100px;color:var(--text-secondary);">${name}</span>
                        <span>â†’</span>
                        <select class="form-select" style="flex:1;" onchange="currentMatchData.matches['${name}']=this.value">
                            <option value="">ì œì™¸</option>
                            ${appData.guilds.map(g => `<optgroup label="${g}">${(appData.members[g] || []).map(n => {
                                const val = JSON.stringify({ guild: g, name: n });
                                const selected = match && match.guild === g && match.match === n ? 'selected' : '';
                                return `<option value='${val}' ${selected}>[${g}] ${n}</option>`;
                            }).join('')}</optgroup>`).join('')}
                        </select>
                    </div>
                `;
            }).join('');
            
            document.getElementById('matchModal').classList.add('active');
        }
        
        function closeMatchModal() { document.getElementById('matchModal').classList.remove('active'); currentMatchData = null; }
        
        function confirmMatch() {
            if (!currentMatchData) return;
            const upload = appData.uploads.find(u => u.id === currentMatchData.uploadId);
            if (!upload) return;
            
            const matched = [];
            Object.values(currentMatchData.matches).forEach(v => { if (v) try { matched.push(JSON.parse(v)); } catch {} });
            
            upload.matchedNames = matched.filter((v, i, a) => a.findIndex(t => t.name === v.name) === i);
            upload.status = 'approved';
            upload.approvedBy = currentAdmin.id;
            upload.approvedDate = new Date().toISOString();
            
            saveData();
            closeMatchModal();
            renderPendingUploads();
            renderAll();
            showToast(`ìŠ¹ì¸! ${upload.matchedNames.length}ëª… ë°˜ì˜`, 'success');
        }
        
        // ==================== MATCHING ====================
        function getAllMembers() {
            const all = [];
            for (const guild of appData.guilds) {
                (appData.members[guild] || []).forEach(name => all.push({ guild, name }));
            }
            return all;
        }
        
        function findSimilarNickname(extracted) {
            const allMembers = getAllMembers();
            const exact = allMembers.find(m => m.name === extracted);
            if (exact) return { match: exact.name, guild: exact.guild, score: 1 };
            
            let bestMatch = null, bestScore = 0;
            for (const member of allMembers) {
                const score = similarity(extracted.toLowerCase(), member.name.toLowerCase());
                if (score > bestScore && score >= 0.6) { bestScore = score; bestMatch = member; }
            }
            return bestMatch ? { match: bestMatch.name, guild: bestMatch.guild, score: bestScore } : null;
        }
        
        function similarity(s1, s2) {
            const longer = s1.length > s2.length ? s1 : s2;
            const shorter = s1.length > s2.length ? s2 : s1;
            if (longer.length === 0) return 1.0;
            return (longer.length - editDistance(longer, shorter)) / longer.length;
        }
        
        function editDistance(s1, s2) {
            const costs = [];
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i === 0) costs[j] = j;
                    else if (j > 0) {
                        let newValue = costs[j - 1];
                        if (s1.charAt(i - 1) !== s2.charAt(j - 1)) newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                        costs[j - 1] = lastValue;
                        lastValue = newValue;
                    }
                }
                if (i > 0) costs[s2.length] = lastValue;
            }
            return costs[s2.length];
        }
        
        // ==================== GUILD/NICKNAME/TIME ====================
        function addGuild() {
            const name = document.getElementById('newGuildName').value.trim();
            if (!name) { showToast('ê¸¸ë“œëª… ì…ë ¥', 'error'); return; }
            if (appData.guilds.includes(name)) { showToast('ì´ë¯¸ ì¡´ì¬', 'warning'); return; }
            appData.guilds.push(name); appData.members[name] = []; saveData();
            document.getElementById('newGuildName').value = '';
            renderGuildList(); updateGuildSelects(); renderGuildFilterChips();
            showToast('ê¸¸ë“œ ì¶”ê°€ë¨', 'success');
        }
        
        function removeGuild(name) {
            if (!confirm(`'${name}' ì‚­ì œ?`)) return;
            appData.guilds = appData.guilds.filter(g => g !== name); delete appData.members[name]; saveData();
            renderGuildList(); updateGuildSelects(); renderGuildFilterChips();
            showToast('ì‚­ì œë¨', 'warning');
        }
        
        function renderGuildList() {
            const container = document.getElementById('guildListContainer');
            if (!container) return;
            container.innerHTML = appData.guilds.map(g => `<div class="tag-item" style="margin:4px;"><span class="guild-badge guild-${g}">${g}</span><span class="member-count">${(appData.members[g] || []).length}ëª…</span><span class="tag-remove" onclick="removeGuild('${g}')">Ã—</span></div>`).join('');
        }
        
        function addNickname() {
            const guild = document.getElementById('newNicknameGuild').value;
            const name = document.getElementById('newNickname').value.trim();
            if (!guild) { showToast('ê¸¸ë“œ ì„ íƒ', 'error'); return; }
            if (!name) { showToast('ë‹‰ë„¤ì„ ì…ë ¥', 'error'); return; }
            if (!appData.members[guild]) appData.members[guild] = [];
            if (appData.members[guild].includes(name)) { showToast('ì´ë¯¸ ì¡´ì¬', 'warning'); return; }
            appData.members[guild].push(name); saveData();
            document.getElementById('newNickname').value = '';
            renderNicknameList(); showToast('ì¶”ê°€ë¨', 'success');
        }
        
        function addBulkNicknames() {
            const guild = document.getElementById('bulkNicknameGuild').value;
            const text = document.getElementById('bulkNicknames').value;
            if (!guild) { showToast('ê¸¸ë“œ ì„ íƒ', 'error'); return; }
            const names = text.split('\n').map(n => n.trim()).filter(n => n);
            if (!appData.members[guild]) appData.members[guild] = [];
            let added = 0;
            names.forEach(name => { if (!appData.members[guild].includes(name)) { appData.members[guild].push(name); added++; } });
            saveData(); document.getElementById('bulkNicknames').value = '';
            renderNicknameList(); showToast(`${added}ëª… ì¶”ê°€`, 'success');
        }
        
        function removeNickname(guild, name) {
            if (!confirm('ì‚­ì œ?')) return;
            appData.members[guild] = appData.members[guild].filter(n => n !== name); saveData();
            renderNicknameList(); showToast('ì‚­ì œë¨', 'warning');
        }
        
        function editNickname(guild, oldName) {
            const newName = prompt('ìƒˆ ë‹‰ë„¤ì„:', oldName);
            if (!newName || newName === oldName) return;
            const idx = appData.members[guild].indexOf(oldName);
            if (idx > -1) {
                appData.members[guild][idx] = newName;
                saveData(); renderNicknameList(); renderAll();
                showToast('ë³€ê²½ë¨', 'success');
            }
        }
        
        function renderNicknameList() {
            const container = document.getElementById('nicknameListContainer');
            if (!container) return;
            const filterGuild = document.getElementById('nicknameGuildSelect')?.value || '';
            const guildsToShow = filterGuild ? [filterGuild] : appData.guilds;
            let total = 0;
            guildsToShow.forEach(g => total += (appData.members[g] || []).length);
            
            container.innerHTML = `<p style="color:var(--text-secondary);margin-bottom:15px;">ì´ ${total}ëª…</p>` +
                guildsToShow.map(guild => {
                    const members = appData.members[guild] || [];
                    if (!members.length) return '';
                    return `<div style="margin-bottom:20px;"><h4 style="margin-bottom:10px;"><span class="guild-badge guild-${guild}">${guild}</span> ${members.length}ëª…</h4><div class="tag-input-container">${members.map(name => `<div class="tag-item"><span>${name}</span><span class="tag-edit" onclick="editNickname('${guild}','${name}')">âœï¸</span><span class="tag-remove" onclick="removeNickname('${guild}','${name}')">Ã—</span></div>`).join('')}</div></div>`;
                }).join('');
        }
        
        function updateGuildSelects() {
            const options = appData.guilds.map(g => `<option value="${g}">${g}</option>`).join('');
            ['nicknameGuildSelect', 'newNicknameGuild', 'bulkNicknameGuild'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = (id === 'nicknameGuildSelect' ? '<option value="">ì „ì²´</option>' : '') + options;
            });
        }
        
        function addTimeSlot() {
            const slot = document.getElementById('newTimeSlot').value.trim();
            if (!slot) { showToast('ì‹œê°„ ì…ë ¥', 'error'); return; }
            if (appData.timeSlots.includes(slot)) { showToast('ì´ë¯¸ ì¡´ì¬', 'warning'); return; }
            appData.timeSlots.push(slot); saveData();
            document.getElementById('newTimeSlot').value = '';
            renderTimeSlotList(); updateTimeSlotOptions(); updateFilterTimeOptions();
            showToast('ì¶”ê°€ë¨', 'success');
        }
        
        function removeTimeSlot(slot) {
            if (!confirm('ì‚­ì œ?')) return;
            appData.timeSlots = appData.timeSlots.filter(s => s !== slot); saveData();
            renderTimeSlotList(); updateTimeSlotOptions(); updateFilterTimeOptions();
            showToast('ì‚­ì œë¨', 'warning');
        }
        
        function renderTimeSlotList() {
            const container = document.getElementById('timeSlotListContainer');
            if (!container) return;
            container.innerHTML = appData.timeSlots.length === 0 ? '<div class="empty-state"><p>ì‹œê°„ëŒ€ ì—†ìŒ</p></div>' :
                appData.timeSlots.map(s => `<div class="tag-item" style="margin:4px;"><span>${s}</span><span class="tag-remove" onclick="removeTimeSlot('${s}')">Ã—</span></div>`).join('');
        }
        
        function updateTimeSlotOptions() { const el = document.getElementById('participationTime'); if (el) el.innerHTML = '<option value="">ì„ íƒ</option>' + appData.timeSlots.map(s => `<option value="${s}">${s}</option>`).join(''); }
        function updateFilterTimeOptions() { const el = document.getElementById('filterTime'); if (el) el.innerHTML = '<option value="">ì „ì²´</option>' + appData.timeSlots.map(s => `<option value="${s}">${s}</option>`).join(''); }
        
        // ==================== LOGS/ADMIN ====================
        function renderLogs() {
            const container = document.getElementById('logsContainer');
            if (!container) return;
            if (!appData.logs.length) { container.innerHTML = '<div class="empty-state"><p>ë¡œê·¸ ì—†ìŒ</p></div>'; return; }
            const logs = [...appData.logs].reverse().slice(0, 100);
            container.innerHTML = `<table class="data-table"><thead><tr><th>ì‹œê°„</th><th>ì—…ë¡œë”</th><th>ë³´íƒ</th><th>ë¯¸ì°¸ì—¬</th><th>IP</th><th>ì¸ì‹</th></tr></thead><tbody>${logs.map(l => `<tr><td>${new Date(l.date).toLocaleString('ko-KR')}</td><td>${l.uploaderNickname}</td><td>${l.timeSlot}</td><td>${l.absentMainChar || '-'}</td><td style="font-family:monospace;font-size:0.8rem;">${l.ip}</td><td>${l.extractedCount}ëª…</td></tr>`).join('')}</tbody></table>`;
        }
        
        async function addAdmin() {
            const id = document.getElementById('newAdminId').value.trim();
            const pw = document.getElementById('newAdminPw').value;
            if (!id || !pw) { showToast('ì…ë ¥ í•„ìš”', 'error'); return; }
            if (appData.admins.some(a => a.id === id)) { showToast('ì´ë¯¸ ì¡´ì¬', 'warning'); return; }
            
            const pwHash = await sha256(pw);
            appData.admins.push({ id, pwHash }); 
            saveData();
            document.getElementById('newAdminId').value = ''; 
            document.getElementById('newAdminPw').value = '';
            renderAdminList(); 
            showToast('ì¶”ê°€ë¨ (ì•”í˜¸í™” ì €ì¥)', 'success');
        }
        
        function removeAdmin(id) {
            if (!confirm('ì‚­ì œ?')) return;
            appData.admins = appData.admins.filter(a => a.id !== id); saveData();
            renderAdminList(); showToast('ì‚­ì œë¨', 'warning');
        }
        
        function renderAdminList() {
            const container = document.getElementById('adminListContainer');
            if (!container) return;
            container.innerHTML = !appData.admins.length ? '<div class="empty-state"><p>ê´€ë¦¬ì ì—†ìŒ</p></div>' :
                appData.admins.map(a => `<div class="tag-item" style="margin:4px;"><span>${a.id}</span><span class="security-badge" style="margin-left:8px;">ğŸ”’ ì•”í˜¸í™”</span><span class="tag-remove" onclick="removeAdmin('${a.id}')">Ã—</span></div>`).join('');
        }
        
        // ==================== STATS ====================
        function renderGuildFilterChips() {
            const container = document.getElementById('guildFilterChips');
            if (!container) return;
            container.innerHTML = `<div class="guild-chip ${selectedGuildFilter === '' ? 'active' : ''}" onclick="setGuildFilter('')">ì „ì²´</div>` +
                appData.guilds.map(g => `<div class="guild-chip ${selectedGuildFilter === g ? 'active' : ''}" onclick="setGuildFilter('${g}')"><span class="guild-badge guild-${g}" style="margin-right:0;">${g}</span></div>`).join('');
        }
        
        function setGuildFilter(guild) { selectedGuildFilter = guild; renderGuildFilterChips(); renderStats(); }
        
        function renderStats() {
            const startDate = document.getElementById('filterStartDate')?.value;
            const endDate = document.getElementById('filterEndDate')?.value;
            const timeFilter = document.getElementById('filterTime')?.value;
            
            const { participation, gehennaTotalRounds, fieldTotalRounds } = calculateParticipation(selectedGuildFilter, startDate, endDate, timeFilter);
            
            const entries = Object.entries(participation)
                .map(([key, data]) => {
                    const [guild, name] = key.split('|||');
                    return { 
                        guild, 
                        name, 
                        total: data.total,
                        gehenna: data.gehenna,
                        field: data.field,
                        gehennaRate: gehennaTotalRounds > 0 ? (data.gehenna / gehennaTotalRounds * 100) : 0,
                        fieldRate: fieldTotalRounds > 0 ? (data.field / fieldTotalRounds * 100) : 0
                    };
                })
                .sort((a, b) => b.total - a.total);
            
            const totalMembers = entries.length;
            const totalParticipations = entries.reduce((sum, e) => sum + e.total, 0);
            const totalGehennaParticipations = entries.reduce((sum, e) => sum + e.gehenna, 0);
            const totalFieldParticipations = entries.reduce((sum, e) => sum + e.field, 0);
            
            document.getElementById('statTotalMembers').textContent = totalMembers;
            document.getElementById('statTotalParticipations').textContent = totalParticipations;
            document.getElementById('statApprovedUploads').textContent = gehennaTotalRounds + fieldTotalRounds;
            
            // ê²Œí—¨ë‚˜/í•„ë“œìŸ í†µê³„
            document.getElementById('statGehennaCount').textContent = totalGehennaParticipations;
            document.getElementById('statGehennaTotalRounds').textContent = gehennaTotalRounds;
            document.getElementById('statFieldCount').textContent = totalFieldParticipations;
            document.getElementById('statFieldTotalRounds').textContent = fieldTotalRounds;
            
            renderStatsTable(entries, gehennaTotalRounds, fieldTotalRounds);
            renderCharts(entries);
        }
        
        function applyStatsFilter() { renderStats(); showToast('í•„í„° ì ìš©', 'success'); }
        
        function renderStatsTable(entries, gehennaTotalRounds, fieldTotalRounds) {
            const container = document.getElementById('statsTableContainer');
            if (!entries.length) { container.innerHTML = '<div class="empty-state"><p>ë°ì´í„° ì—†ìŒ</p></div>'; return; }
            const maxCount = Math.max(...entries.map(e => e.total));
            
            container.innerHTML = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>ê¸¸ë“œ</th>
                                <th>ë‹‰ë„¤ì„</th>
                                <th>ì´ ì°¸ì—¬</th>
                                <th style="color:var(--accent-pink);">ğŸ”¥ ê²Œí—¨ë‚˜</th>
                                <th style="color:var(--success);">âš”ï¸ í•„ë“œìŸ</th>
                                <th>ì°¸ì—¬ìœ¨ ë°”</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${entries.map((e, i) => `
                                <tr class="${i === 0 ? 'rank-1-row' : i === 1 ? 'rank-2-row' : i === 2 ? 'rank-3-row' : ''}">
                                    <td><span class="rank-badge ${i < 3 ? 'rank-'+(i+1) : 'rank-other'}">${i+1}</span></td>
                                    <td><span class="guild-badge guild-${e.guild}">${e.guild}</span></td>
                                    <td style="font-weight:${i < 3 ? '700' : '500'};">${e.name}</td>
                                    <td style="font-weight:${i < 3 ? '700' : '400'};color:${i === 0 ? '#ffd700' : i === 1 ? '#c0c0c0' : i === 2 ? '#cd7f32' : 'inherit'};">${e.total}íšŒ</td>
                                    <td>
                                        <span style="color:var(--accent-pink);font-weight:600;">${e.gehenna}íšŒ</span>
                                        <span style="color:var(--text-secondary);font-size:0.8rem;margin-left:4px;">(${e.gehennaRate.toFixed(1)}%)</span>
                                    </td>
                                    <td>
                                        <span style="color:var(--success);font-weight:600;">${e.field}íšŒ</span>
                                        <span style="color:var(--text-secondary);font-size:0.8rem;margin-left:4px;">(${e.fieldRate.toFixed(1)}%)</span>
                                    </td>
                                    <td>
                                        <div class="progress-bar" style="min-width:100px;">
                                            <div class="progress-fill" style="width:${Math.round((e.total/maxCount)*100)}%"></div>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function renderCharts(entries) {
            const top10 = entries.slice(0, 10);
            const labels = top10.map(e => `[${e.guild}] ${e.name}`);
            const data = top10.map(e => e.total);
            const colors = ['#ffd700', '#c0c0c0', '#cd7f32', '#00d4ff', '#a855f7', '#22c55e', '#f59e0b', '#ef4444', '#ec4899', '#06b6d4'];
            
            if (pieChart) pieChart.destroy();
            if (barChart) barChart.destroy();
            
            pieChart = new Chart(document.getElementById('pieChart').getContext('2d'), {
                type: 'doughnut',
                data: { labels, datasets: [{ data, backgroundColor: colors, borderColor: '#14141f', borderWidth: 2 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#f0f0f5', font: { size: 10 }, boxWidth: 12, padding: 6 } } } }
            });
            
            barChart = new Chart(document.getElementById('barChart').getContext('2d'), {
                type: 'bar',
                data: { labels, datasets: [{ label: 'ì°¸ì—¬', data, backgroundColor: colors, borderRadius: 6, borderSkipped: false }] },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } }, scales: { x: { grid: { color: '#2a2a3a' }, ticks: { color: '#888899' } }, y: { grid: { display: false }, ticks: { color: '#f0f0f5', font: { size: 10 } } } } }
            });
        }
        
        async function exportStatsAsImage() {
            showProcessing('ì´ë¯¸ì§€ ìƒì„± ì¤‘...');
            try {
                const canvas = await html2canvas(document.getElementById('statsExportArea'), { backgroundColor: '#0a0a0f', scale: 2 });
                const link = document.createElement('a');
                link.download = `ë±€í”¼ë¥´_ì°¸ì—¬ìœ¨_${selectedGuildFilter || 'ì „ì²´'}_${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL();
                link.click();
                hideProcessing();
                showToast('ì €ì¥ë¨', 'success');
            } catch (e) { hideProcessing(); showToast('ì‹¤íŒ¨', 'error'); }
        }
        
        function renderRecentUploads() {
            const container = document.getElementById('recentUploads');
            if (!container) return;
            
            const allItems = [];
            appData.uploads.forEach(u => allItems.push({ type: 'upload', uploader: u.uploaderNickname, date: u.uploadDate, timeSlot: u.timeSlot, status: u.status, imageData: u.imageData, count: u.matchedNames?.length || u.extractedNames?.length || 0 }));
            appData.gistData.forEach(g => allItems.push({ type: 'gist', uploader: `[${g.uploader.guild}] ${g.uploader.nickname}`, date: g.date, timeSlot: g.timeSlot, status: 'gist', count: g.participants.length }));
            allItems.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (!allItems.length) { container.innerHTML = '<div class="empty-state"><p>ë‚´ì—­ ì—†ìŒ</p></div>'; return; }
            
            container.innerHTML = allItems.slice(0, 15).map(item => {
                let statusHtml = '';
                if (item.status === 'pending') statusHtml = '<span class="status-indicator pending"><span class="status-dot pending"></span>ìŠ¹ì¸ ëŒ€ê¸°</span>';
                else if (item.status === 'approved') statusHtml = '<span class="status-indicator approved"><span class="status-dot approved"></span>í†µê³„ ë°˜ì˜</span>';
                else if (item.status === 'gist') statusHtml = '<span class="status-indicator gist"><span class="status-dot gist"></span>ìë™ ìˆ˜ì§‘</span>';
                else if (item.status === 'rejected') statusHtml = '<span class="badge badge-rejected">ê±°ì ˆ</span>';
                
                return `<div class="feed-item"><div class="feed-info"><span class="feed-uploader">${item.uploader}</span>${statusHtml}<div class="feed-meta">${new Date(item.date).toLocaleString('ko-KR')} | ${item.timeSlot || '-'} | ${item.count}ëª…</div></div>${item.imageData ? `<img src="${item.imageData}" class="feed-thumb" onclick="showImageModal('${item.imageData}')">` : ''}</div>`;
            }).join('');
        }
        
        // ==================== UTILITIES ====================
        async function getImageHash(file) {
            return new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = canvas.height = 16;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, 16, 16);
                        const data = ctx.getImageData(0, 0, 16, 16);
                        let hash = '';
                        for (let i = 0; i < data.data.length; i += 4) hash += (data.data[i] + data.data[i+1] + data.data[i+2]) / 3 > 128 ? '1' : '0';
                        resolve(hash);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        function fileToBase64(file) { return new Promise((res, rej) => { const r = new FileReader(); r.onload = () => res(r.result); r.onerror = rej; r.readAsDataURL(file); }); }
        async function getUserIP() { try { return (await (await fetch('https://api.ipify.org?format=json')).json()).ip; } catch { return 'Unknown'; } }
        
        function showToast(msg, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span style="font-size:1.2rem;">${{success:'âœ“',warning:'âš ',error:'âœ•'}[type]}</span><span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.animation = 'slideIn 0.3s ease reverse'; setTimeout(() => toast.remove(), 300); }, 3000);
        }
        
        function showProcessing(text) { document.getElementById('processingText').textContent = text; document.getElementById('processingOverlay').classList.add('active'); }
        function hideProcessing() { document.getElementById('processingOverlay').classList.remove('active'); }
        function showImageModal(src) { document.getElementById('modalImage').src = src; document.getElementById('imageModal').classList.add('active'); }
        function closeImageModal() { document.getElementById('imageModal').classList.remove('active'); }
        
        document.querySelectorAll('.modal-overlay').forEach(o => o.addEventListener('click', e => { if (e.target === o) o.classList.remove('active'); }));
        
        init();
    </script>
</body>
</html>
